[{"content":"概要 PXUA216MB-DL2-M是基于XMOS XU216-512-TQ128-C主控设计的 USB 16路麦克风采集评估板，能够实现通过USB UAC 2.0协议实时地，同步地传输16路麦克风原始信号到操作系统端。往下兼容其他麦克风的任何数量麦克风采集。\nPXUA216MB-DL2-M评估板能够同步采集 16 路数字 MIC 信号以及 2 路回采信号，同时支持立体声播放，所有数据均通过 USB 进行传输，评估板主要提供给具备一定算法能力的声学企业以及个人使用。\n评估板USB UAC 2.0（USB Audio Class 2.0）协议兼容 Windows、Linux 和 Android 操作系统, 16个麦克风小板做分离式设计，可移动的，麦克风小板为底部拾音。灵活实现多种麦克风阵型布置需求。\nPXUA216MB-DL2-M评估板无内置任何麦克风阵列算法，主要功能为实时地，高一致性地传输16路麦克风原始信号。同时评估板集成了line-in和Line-out端子，通过USB传输16路麦克风+2路Line-in音轨，下行播放line-out 立体声播放。\n版本    产品版本 修改 发布时间     V1 初次发布 2017年10月20日   V2 修改了麦克风小板的尺寸 2018年9月25日    特点  USB UAC 2.0协议传输，作为外置声卡使用 16 PDM 数字麦克风，分离式设计，麦克风小板可以移动 支持 16KHz/48 KHz @16bit /24bit音频采样率， 支持 1 路Line-in模拟输入和1 路Line-out 模拟输出  规格   XMOS XU216主控\n· 16 个逻辑核心\n· 高达 2000MIPS 处理速度\n· 512KB RAM\n  16路PDM 数字麦克风：SPK0641HT4H\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64.5 dBA\n  供电：USB 5V\n  尺寸：87 × 70 mm （base board）, 10 x 8 mm（MIC board）\n  line-in \u0026amp; line-out\n· Codec: CS42L51\n  音频传输：\n· USB UAC 2.0 输入输出\n· 采样率：16 KHz/48 KHz , 16 bit/24 bit\n  功耗: 5V, 180mA （Max）\n  硬件概述  XMOS XU216 ：完成16 路PDM 麦克风，2路I2S信号整合，进行UAC协议传输 Micro USB : 提供5V电源，并且传输音频和固件更新，控制和调试 Codec CS42L51：XU216 2路I2S的编码和解码 Line-in：Codec芯片的line-in 3.5 mm耳机孔，支持增加2路模拟输入录制 Line-out: Codec 芯片的Line-out 3.5 mm耳机孔，UAC 2.0 播放，模拟输出 MIC0~15：PDM 数字麦克风，通过接线和连接器的方式，方便移动  应用场合  麦克风阵列算法研究 全景声音采集 语音识别声音采集  第一次使用 通常情况下，用户拿到PXUA216MB-DL2-M评估板后，建议先在Windows系统做初步使用和认证。使用Micro USB 数据线来连接PXUA216MB-DL2-M评估板和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了PXUA216MB-DL2-M评估板\n如图显示的PawPaw DFU 和PawPaw Microphone array UAC 2.0 说明PXUA216MB-DL2-M评估板已经成功枚举，但是还没不能使用，需要安装UAC 2.0驱动。\n仅Windows系统系统需要按照UAC 2.0驱动，linux和MAC OS都不需要另外安装UAC 2.0驱动\n安装驱动 Windows系统：\n评估板使用 USB Audio Class 2.0 作为传输协议，因此在window系统上需要安装第三方驱动，驱动压缩包是：USB-Audio-Class-2.0-Evaluation-Driver-for-Windows_4.13.0.zip。\n压缩该文件后，得到的是一个.exe 文件，可以直接安装，但是我司建议不要如此安装，接着对该.exe 文件再一次进行解压得到文件\nXMOS_TUSBAudio_eval_v4.13.0_2019-01-21_setup，其大体内容为，\n确保评估板的USB已经和windows系统电脑，再点击运行文件夹了里面的setup_eval.exe 安装驱动程序。进入安装过程中，默认安装即可（一路点击 next，直接进行安装），UAC 2.0驱动安装完成后，windows设备管理器显示如图，则表示设备安装成功\n运行setup_eval.exe\n 确保评估板的USB已经和windows系统电脑 默认安装即可（一路点击 next，直接进行安装） 安装完成了后，则会出现类似如下图片显示 评估板在设备管理器上枚举成了 XMOS USB 2.0 Audio Devices-\u0026gt;XMOS XS1-U8 DJ(EVAL)  在声音界面进行设置和确认,\n1，在播放栏项，设置XMOS XS1-U8 DJ(EVAL)为默认设备,确认采样率是否为16bit，16000 Hz，禁用所有增强性能\n2，在录制栏项，设置XMOS XS1-U8 DJ(EVAL)为默认设备,确认采样率是否为 18通道 16bit，16000 Hz，禁用所有增强性能\n3，同时确认播放和录制栏项的音频格式设置为一致，如16bit ，16000KHz或者16bit 48000KHz\nLinux系统：不需要安装驱动\nMac 系统：不需要安装驱动\nDemo 和录音 安装和使用（Audacity）第三方开源录音软件在Windows系统进行录音设置，接着使用Audacity录音。\nPXUA216MB-DL2-M评估板出厂默认固件为USB输入18ch 16kHz采样率的声源，其中ch[1-16]为16路麦克风原始信号，ch[17-18]为line-in的2路模拟信号，用户通常用来回音消除的参考信号。\n在其他操作系统如MAC OSX和Linux操作系统，Demo和录音的用法跟Windows类似。\n","description":"介绍USB 16路麦克风采集评估板 PXUA216MB-DL2-M_的硬件使用，","id":0,"section":"docs","tags":null,"title":"PXUA216MB-DL2-M_硬件使用","uri":"http://docs.pawpaw.ltd/docs/pxua216mb-dl2-m/pxua216mb-dl2_usage/"},{"content":"XMOS的XTAG调试工具为XMOS芯片专用调试和烧录工具，包含JTAG，复位，在线调试和烧录程序，还有高级调试，xtag对于XMOS芯片开发都必不可少的。\n木瓜电子提供转接板主要是是为了减小XTAG的占用面积，建议用户在硬件设计的时候使用2x5 1.27mm的端子来代替XTAG的2X10 2.54mm的大端子，以减小PCBA面积和减少layout走线。\n转接原理如下图\n其实物如下图，用户需要自行焊接转接板的端子，并且遵循其搭建过程\nXTAG硬件用户需自行购买，而XTAG转接板所需的物料器件，木瓜电子可免费提供给到用户，由用户自行焊接\n","description":"XTAG的转接板说明，主要是减小XTAG调试器接口减小面积，以及焊接，安装，使用说明","id":1,"section":"notes","tags":null,"title":"XMOS XTAG 转接板","uri":"http://docs.pawpaw.ltd/notes/xmos_xtag_adapter_board/"},{"content":"概要 XMOS 芯片现有平台内置麦克风阵列算法的芯片信号为XVF3000,XVF35000,XVF3510。内置麦克风阵列算法，包含回音消除，波束成形，语音增强，噪声抑制等算法，接口带有USB和I2S等，仅支持PDM数字麦克风。这几个芯片平台都配有相应的评估板，其中的平台区别如下文描述，用户根据需求，自行选择。\n区别    属性 XVF3000 XVF3500 XVF3510     成本 高 高 低   封装 TQFP-128 FBGA-167 QFN-60   功耗 ~700 mW ~1 W ~600 mW   Flash 内置QSPI Flash 外置QSPI Flash 外置QSPI Flash   麦克风数量 4路PDM 数字麦克风 4路PDM 数字麦克风 2路PDM 数字麦克风   阵型 圆形/线形 4麦 线形 4麦 线形 2麦   发布时间 2017 2018 2019   开源情况 代码开源，算法库形式 代码开源，算法库形式 不开源，配置的形式   二次开发 允许 允许 不允许，仅配置   完整型号 XVF3000-TQ128-CA XVF3500-FB167-C XVF3510-QF60-C   评估板 PXVF3000-KIT PXVF3500-KIT PXVF3510-KIT   算法方向 会议通话/语音识别 会议通话/语音识别 会议通话/语音识别   算法优势 会议通话 会议通话 语音识别   AEC性能 mono AEC，非常好 stereo AEC ，非常好 stereo AEC，一般   Beam-forming 有 有 有，但弱化了   点噪消除 无 无 有，抗噪能力强   DOA 有，圆形可输出360度定位角度 有，线形输出180度定位角度 无，无输出角度信息         DSP 参数调整 较多参数可调整 较多参数可调整 较少参数可调整   DSP 参数固化 需在代码固化 需在代码固化 可上位机写入固化    选型建议 根据这三个平台的区别，木瓜电子提供选型思路参考如下\n针对用途\n  语音识别用途：建议选择XVF3510 2麦阵列，其重点优化了语音识别的前端算法，对接亚马逊，谷歌，阿里，讯飞，百度等平台有较高的识别率\n  会议通话用途：建议选择XVF3000和XVF3500，有非常高的AEC 回音消除性能，并且有较多的较多的降噪DSP参数调整，能够实现非常好的全双工对讲，不建议选择XVF3510做会议通话，全双工对接方面略逊色，并且针对桌面会议和视频通话，选型推荐如下：\n     用途 选型 缘由     桌面会议 XVF3000 可以输出360度定位角度信息，mono AEC(单声道 回音消除，一个喇叭播放)可以满足需求，功耗较优化，可在产品上配置电池供电   视频通话 XVF3500 输出180度前方定位角度信息，stereo AEC 能够吻合视频播放的要求。    针对开发\nXVF300和XVF3000都是开源代码，除了麦克风阵列算法是以库的方式，其他控制和接口的代码都是开放的，可以利用XVF3500和XVF3000芯片做逻辑控制，I/O控制等，当然也是需要熟悉XMOS的开发平台。需要配置软件工程师，或者委托木瓜电子提供固件。芯片和开发成本较高些\nXVF3510不开源代码，XVF3510类似于专用芯片，通过配置的方式实现简单的I/O控制功能，接近免开发，免配置的状态。不需要配置软件工程师即可使用。芯片和开发成本最低。\n针对资源\nXVF3500较其他两者来说，拥有最多的芯片资源，麦克风阵列算法性能最优：拥有立体声 AEC , DOA定位。同时代码开源，并且配置最多I/O资源。\n总结 以上的提供建议仅供参考，如仍困，可以整理项目需求，联系木瓜电子技术部提供专业的评估和选型。根据木瓜电子的芯片出货情况，可以大体看到，桌面会议系统使用XVF3000芯片，大屏视频通话使用XVF3500芯片。新开的项目需要做语音识别，我们都推荐使用XVF3510芯片。\n","description":"XMOS 多个麦克风阵列平台，其4麦阵列和2麦阵列的主要区别描述","id":2,"section":"notes","tags":null,"title":"XMOS 麦克风阵列选型说明","uri":"http://docs.pawpaw.ltd/notes/xmos_array_microphone_selection/"},{"content":"概要 PXVF3000-KIT针对XMOS的XK-VF3100-C43 开发板进行硬件升级，优化了硬件设计及布局，更加适合用户直接使用和项目评估。完全兼容XMOS的XK-VF3100-C43 开发板，所用的DSP芯片为XVF3000，设计成等距圆形4麦阵列。\nPXVF3000-KIT为4麦阵列设备，作为前端信号处理，实现语音增强，可同时输出两路前端处理后的声音信号，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。支持使用USB Audio Class 1协议（UAC1.0）传输音频 ，支持所有流行的操作系统（Windows , MAC, Linux和Android），允许作为USB声卡设备枚举接入操作系统中。\nPXVF3000-KIT内置了单声道回音消除（AEC） , 波束成型（BF），噪声抑制（NS）和自动增益（AGC）算法，非常有效地实现在远距离和嘈杂环境提高语音识别率和通话质量。使用USB 接口快速接入各种操作系统，同时配套提供了多套固件，非常适用用户迅速接入桌面会议产品中。\n版本    产品版本 修改 发布时间     PXVF3000-KIT V1 EOF(停产) 2017年10月20日   PXVF3000-KIT V2 重新修改设计，简化其他硬件，且去掉蓝牙 2020年11月15日    特点   远距离拾音\n  支持USB Audio Class 1.0 (UAC 1.0)\n  支持USB HID 调试和USB DFU升级\n  4路圆形麦克风阵列\n  支持3.5mm耳机孔作为播放输出\n  DSP 算法和特点\n· Voice Activity Detection(VAD)\n· Full duplex, Mono, Acoustic Echo Cancellation(AEC)\n· Beamforming(BF)\n· Noise Suppression (NS)\n· Automatic Gain Control (AGC)\n  规格   XMOS XVF3000 主控，内置4麦圆形阵列算法\n  4路PDM 数字麦克风：SPK0641HT4H\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64.5 dBA\n  供电：USB 5V\n  尺寸：70mm（Circle）\n  USB播放-\u0026gt;3.5mm耳机孔模拟line-out\n· DAC: ES7154\n· 3.5mm耳机孔\n  音频传输：\n· USB UAC 1.0 输入输出，USB播放信号经过XVF3000作为AEC参考信号\n· 采样率：16KHz/48KHz\n  功耗: 5V, 180mA （Max）\n  硬件概述  XMOS XVF3000 ：集成了UAC1.0和4 MIC阵列算法，包含了单声道回音消除（mono AEC） , 波束成形（BF），噪声抑制（NS）和自动增益（AGC）算法 Micro USB : 提供5V电源，并且传输音频和固件更新，控制和调试 DAC ES7154：USB 声卡（UAC1）音频输出解码芯片 XMOS XTAG：XMOS专用调试工具XA-XTAG接口 Phone-jack：DAC的芯片的line-out 3.5mm耳机孔 MIC0~4：PDM 数字麦克风，圆形等距分布  系统连接框图 尺寸 应用场合  桌面会议（Comms） 医疗设备（ASR） 智能管家（ASR） 智能机器人（ASR）  开始 第一个Demo 通常情况下，用户拿到PXVF3000-KIT PCBA板后，建议先在Windows系统做初步使用和认证。使用Micro USB 数据线来连接PXVF3000-KIT和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了PXVF3000-KIT，并且打开声音控制面板进行设置\n确认设备管理器-\u0026gt;音频输入和输出是否存在\nXMOS VoclalFusion SPK(uac1.0)是否成功枚举，PXVF3000-KIT作为USB Audio Class 1.0设备\n关于 于XMOS Control可以在后面需要调试时在安装驱动，初次使用时可以先跳过 在声音界面进行设置和确认\n1，在播放栏项，设置XMOS VoclalFusion SPK(uac1.0)为默认设备\n2，在录制栏项，设置XMOS VoclalFusion SPK(uac1.0)为默认设备\n3，同时确认播放和录制栏项的音频格式设置为一致，如16bit ，16000KHz或者16bit 48000KHz\nDemo 和录音 使用Audacity）第三方开源录音软件在Windows系统进行录音设置，接着使用Audacity录音。\nPXVF3000-KIT出厂默认固件为USB输入6ch 16kHz采样率处理后的声源，其中ch0为Comms信号，ch[1-4]为mic[0-3] 麦克风的原始信号，ch5为回音消除的参考信号。\n在通常的操作系统中，系统都会默认使用ch0作为ASR或者Comms来当作麦克风输入，所以PXVF3000-KIT输入6ch并不会影响实际上的使用。 在其他操作系统如MAC OSX和Linux操作系统，Demo和录音的用法跟Windows类似。\n固件和DFU升级 如果PXVF3000-KIT的出厂默认固件满足不了用户的配置需求，可以在Firmware中选择其他配套的固件，使用USB数据线连接PC电脑，使用配套提供的DFU(Device Firmware Update)工具进行更新固件。\n安装驱动 Windows系统：\nPXVF3000-KIT在操作系统中都能识别成XMOS VoclalFusion SPK(uac1.0)作为声卡输入输出，而Windows系统中的设备管理器显示的XMOS Control需要安装USB驱动，才能使用XMOS提供的dfu_usb工具进行升级和vfcrtol_usb工具进行DSP 参数控制。推荐使用第三方工具zadig进行安装XMOS Control的USB驱动。\n运行zadig，\n 在列表中选择 XMOS Control (Interface 3) 然后选择 libusb-win32 点击 Reinstall Driver 安装完成了后，则会出现类似如下图片显示  Linux系统：不需要安装驱动\nMac 系统：不需要安装驱动\n固件列表 这里配套提供了7个固件，主要是USB的音频的通道数，算法方向和采样率作为区别，参考下表。\n   Firmware channel ch0 ch1 采样率 Description     app_vf_spk_base_cir32_1i1o2.dfu 1 Comms - 16000Hz Comms output   app_vf_spk_base_cir32_1i1o2_48khz.dfu 1 Comms - 48000Hz 48kHz Comms output   app_vf_spk_base_cir32_1i1o2_asr.dfu 1 ASR - 16000Hz ASR output   app_vf_spk_base_cir32_1i2o2.dfu 2 Comms ASR 16000Hz ch0:Comms; ch1:ASR   app_vf_spk_base_cir32_1i2o2_48khz.dfu 2 Comms ASR 48000Hz ch0:Comms; ch1:ASR   app_vf_spk_base_cir32_1i6o2.dfu 6 Comms mic-0 16000Hz default firmware ch0:Comms; ch1:mic0; ch2:mic1; ch3:mic2; ch4:mic3; ch5: mono aec_ref;   app_vf_spk_base_cir32_1i6o2_asr.dfu 6 ASR mic-0 16000Hz ch0: ASR ch1:mic0; ch2:mic1; ch3:mic2; ch4:mic3; ch5: mono aec_ref;    DFU升级 Windows系统：\nPXVF3000-KIT使用USB进行DFU升级的工具为dfu_usb.exe，打开cmd命令行终端工具，cd进入pvf3000/xvf3000_dfu文件夹，键入如下指令或者或者复制其中对于固件的指令进行运行。\ndfu_usb write_upgrade ../firmware/app_vf_spk_base_cir32_1i1o2.dfu\r执行完之后，打印出一下信息说明固件DFU升级成功\n Attempting to connect via USB: connected\rSending file size: 0x24600 padded to 0x24600\rWritten bytes: 0x24600\rdone\r其他操作系统如Mac OS和Linux的使用Terminal，键入指令和打印的内容一致。DFU升级成功后，需要对板子重启或者重新上电\ndfu_usb reboot\r在通常情况下，在windows系统DFU升级成功后，PXVF3000-KIT会遇到无法录制使用，问题可以在[FAQ](# FAQ):Q2找到答案 在其他操作系统\n需要提前编译出dfu_usb工具，进入路径pxvf3000/xvf3000_dfu/host/xmosdfu，然后执行同上的dfu_usb指令，可以得到同样的结果\nMac OS:\nmake -f Makefile.OSX\rLInux:\nmake -f Makefile.Linux64\rRaspberry Pi\nmake -f Makefile.Pi\rDSP control 在线调试 上文提供的所有固件都是使用XMOS Vocal Fusion默认的DSP参数，其实PXVF3000-KIT也支持在线调试麦克风阵列DSP 算法参数。使用DSP Control工具为vfctrol_usb（exe）。在进行在线调试工作前，建议用户认真阅读XMOS的文档资料XVF3000-3100-DSP-Databrief。足够了解麦克风阵列相关算法名称和DSP 参数，才方便进行在线调试。并且下文描述内容跟XMOS提供的文档一致。\n以下内容已经假设用户对麦克风阵列的DSP算法，已经有一定的了解，或者根据文档自行了解熟悉，并且了解其DSP参数和数值\nAcoustic Echo Cancellation (AEC)\nBeamforming(BF)\nVoice Activity Detection (VAD)\nNoise Suppression (NS)\nAutomatic Gain Control (AGC)\n 在线调试 windows系统\n确保PXVF3000-KIT在设备管理器中的XMOS Control驱动已经安装（仅windows系统需要）\nwindows系统，运行cmd，并且cd进入pxvf3000/xvf3000_control，键入类似指令以运行vfctrol_usb，便可进行在线调试\nvfctrl_usb MIN_NS\r打印输出的信息如下：\nMIN_NS:0.15\r其他操作操作系统运行Terminal终端，但是同时需要提前编译出vfctrol_usb工具，进行同样的操作即可。cd进入路径pxvf3000/xvf3000_control/host/control。\nMac OS:\nmake -f Makefile.OSX\rLInux:\nmake -f Makefile.Linux64\rRaspberry Pi\nmake -f Makefile.Pi\rXVF3000里面有很多DSP参数可配置，用户根据XVF3000-3100-DSP-Databrief的介绍，可以实现通过USB HID（XMOS Control）进行在线调试参数\n在线调试的参数仅存在XVF3000 RAM内存中， 断电即复位为默认值，如确实需要保存已调试的参数到flash中，需要生成DFU配置固件。 资源下载 PXVF3000-KIT.zip全部的资料(点击下载)\n支持和商务 PXVF3000-KIT支持PCBA定制服务，提供批量PCBA和芯片供应服务。\n任何的技术支持和商务合作，可以直接邮箱联系我们：pxvf3000@pawpaw.hk，或者访问www.pawpaw.hk了解更多。\nFAQ Q1: 回音消除怎么使用\nPXVF3000-KIT的AEC的参考信号只有一个路径，即通过USB当作播放声卡，声音经过XVF3000时会保留AEC参考信号在XVF3000 RAM中，已实现AEC参考信号的提供。\nQ2: DFU更新完之后，在windows操作系统下使用audacity录制出错的原因\n出现该问题仅是在Windows系统，其他操作系统Mac和Linux并不会存在这个情况。由于windows系统对声卡有记忆功能，DFU固件了后，可能改变了与之前声卡的记忆，导致了使用第三方软件如audacity无法录制音频，这时需要使用usbdeview进行删除Windows的对声卡的记忆。\nUSB连上PXVF3000-KIT和windows PC，运行usbdeview，点击Connected栏项以列出XVF3000相关枚举情况；逐一选择XVF3000的枚举，右击后出现新的界面；选择Uninstall Selected Devices进行删除Windows的声卡的记忆；重新上电即可。\n同时确保windows系统的声音面板的播放栏项和录制栏项音频格式设置为一致，并且建议关闭录音软件，再重新运行录音软件。\nQ3：dfu_usb和vfctrl_usb显示could not find device和无法使用的原因？\n确保USB连接了PXVF3000-KIT和PC，并且确保已经使用了zadig进行安装了XMOS Control的驱动。如果问题仍出现，尝试确认一下XMOS Control是否已经枚举，亦或者卸载XMOS Control驱动，并且使用zadig重新按照。\nQ3: 有提供例程连接语音识别平台吗？\n抱歉，这方面我们没有提供例程，类似Alexa和Aliyun等语音识别API，我们没有办法提供相关例程。\n","description":"介绍PXVF3000-KIT评估板的硬件参数，应用场景，性能和功能，协助用户第一次使用PXVF3000-KIT进行项目评估，和如何DFU更新固件，以及使用vfctrl进行麦克风阵列算法调整","id":3,"section":"docs","tags":null,"title":"PXVF3000-KIT_硬件使用","uri":"http://docs.pawpaw.ltd/docs/pxvf3000-kit/pxvf3000-kit_usage/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3000-KIT，且查阅PXVF3000-KIT_硬件使用 已详细了解XVF3000 内置的前端算法AEC , BF , NS, AGC,，且已查阅PXVF3000-KIT_dsp_描述 已查阅本站XVF3000项目实施落地 已查阅了XVF3000的datasheet和参考设计 已确认XMOS XVF3000 4路麦克风阵列方案性能可满足导入项目产品中  XVF3000 datasheet 导读 查看XVF3000-3100-TQ128-Datasheet_15.pdf，其描述的为xvf3000裸片（不含固件）的硬件特性。了解基本的硬件数据，电气特性。\n基本特性  商用温度等级（0 °C to 70 °C） TQ128 封装 580mA典型工作电流，700mW左右（固件运行） 内置了16Mbit QSPI Flash I/O 驱动能力为4mA  电源 根据datasheet的最小系统框图，XVF3000的需要两路电压供应，3V3和1V0, 其中3V3提供给I/O, USB , Flash等外设使用，1V0提供给XVF3000逻辑核心使用。\n其两路电压时序要求为3V3先上电，稳定后，1V0后上电。\n复位检测 XVF3000需要外部有复位检测芯片，可以选择单独侦测 3V3或者1V0，以避免在电压不正常时，芯片无法复位来运行固件。\nQSPI Flash XVF3000内置了QSPI Flash（IS25LP016D），其主要是存储XVF3000固件，所以XVF3000项目得预先烧录固件才能启动运行4路麦克风阵列算法。使用QSPI Flash烧录器烧录XVF3000需要配置QE=1的烧录方式。\nBOOT MODE XVF3000的由QSPI Flash启动，根据框图连接XVF3000和Flash时，需要确保X0D01上拉1K电阻，以实现boot mode是由XVF3000芯片读取加载内部的QSPI Flash固件。\nI/O 映射 XVF3000的逻辑I/O接口的功能使用由固件定义，datasheet 无描述I/O 功能使用，需参考木瓜电子或者XMOS官方提供的的原理来选择使用特定的I/O map。\n时钟信号 XVF3000外部需要24MHz有源晶振接入作为启动晶振，接入到CLK 引脚，而音频时钟16KHz 和48KHz采样率仍需要一个外部的12.2888MHz音频时钟或者晶体接入作为I2S或者PDM麦克风的MCLK时钟使用。\n原理图和PCB 根据我司或者XMOS官方的提供的参考原理，结合XVF3000的datasheet最小系统。用户可以比较轻易完成XVF3000的最小系统设计，包含了电源，时钟，启动上拉等。\n原理图设计 USB 接口设计 在XVF3000 圆形4路麦克风阵列方案中，USB接口除了提供5V电源供应，仍需要用来作为音频传输，DFU固件，vfctrl调试参数。\nXVF3000 芯片内部集成了USB PHY收发器，可以直接使用芯片引脚USB_DM,USB_DP,USB_VBUS,USB_RTUNE连接外部USB端子。\n遵循XVF3000 datasheet说明，USB的设计分为USB供电或者外部电源作为XVF3000芯片供电两种情况，如图为USB作为整个XVF3000系统供电原理设计\n根据XVF3000 datasheet的描述\n USB_RTUNE 需要下拉43.2 R电阻 USB_VBUS 和USB_ID 不能连接，需悬空 USB_VBUS提供5V给DC-DC 转换3V3和1V0电源提供给XVF3000和外围芯片 因为XVF3000 的ESD压力为2KV,建议用户在USB端子设计加入ESD保护电路芯片  如内部有电池或者外部供应5V给整个电源系统，则USB_VBUS的设计需要参考XVF3000 datasheet（page 19）的USB_VBUS设计。\n The 10k series resistor and 0.1uF capacitor ensure than any input transient is filtered and does not reach the device. The 47k resistor to ground is a bleeder resistor to discharge the input capacitor when VBus is not present. The 1-10uF input capacitor is required as part of the USB specification. A typical value would be 2.2uF to ensure the 1uF minimum requirement is met even under voltage bias conditions\n 如用户决定使用XVF3000使用I2S输入输出来连接host主控（ARM,BT,WiFi等芯片）代替USB作为音频传输，同时强烈建议前期保留USB端子以便进行dfu_usb和vfctrl_usb使用。后期确定量产时再去掉USB部分。\n电源设计 XVF3000 内部无DC-DC和LDO集成，需要外部提供3V3和1V0的供电。其中3V3提供给XVF3000及其集成的部分的 I/O供电，1V0供应XVF3000核心及其集成组件的核心使用。查看datasheet的Example Application Diagram的框图，得到XVF3000电源的需求情况。\n3V3 供应部分\n3V3电压范围（3.135 ~ 3.465 V）\n VDDIO (3V3) : Digital I/O power (left,right,top), VDDIOL,VDDIOR,VDDIOT OTP_VCC (3V3) :pins for OTP USB_VDD33 (3V3) : USB Analog power,analog supply to the USB-PHY  1V0 供应部分\n1V0电压范围（0.95 ~ 1.05 V）\n VDD pins (1V0)：Digital tile power ，for the core logic PLL_AVDD (1V0) : Analog power for PLL, pins for the PLL USB_VDD (1V0) : USB Digital tile power , supply to the USB-CORE  查看datasheet的Power Consumption 部分得到XVF3000的核心供电需求电流为580 mA左右（700mA MAX）, 确保DC-DC电源芯片1V0输出需要大于700mA，建议值1A的输出能力,且不能使用LDO电源芯片输出1v0,导致损耗过大。\n根据datasheet所述的3V3和1V0的上电时序要求，我们建议整体电源设计的时序为3V3先上电，然后使能（enable）1v0后上电\n其电源设计如下图，其中\n 3V3由5V DC-DC转换得到，3V3先稳定后，使能另一个DC-DC转换得到1V0 ; 形成 3V3先上电，1V0后上电的时序 3V3和1V0分别供应相应的电源输入引脚，尽量保证每个电源输入引脚有个104的滤波电容，且这些电容在layout的时候，尽量靠近相应的电源引脚。 pin 50 和 pin 65 必须悬空，不能接任何电气 PLL_AVDD 需要一个高品质的电源，在PLL_AVDD引脚加入RC 低通滤波器，且在layout的时候，4R7电阻和104电容需要尽可能靠近PLL_AVDD引脚  系统设置 XVF3000外围需要两个有源晶振，24 MHz 和 12.288 MHz。24 MHz时钟为XVF3000起振时钟，提供给内部PLL产生芯片主频，24 MHz有源晶振输出接入XVF3000的CLK 引脚。12.288 MHz时钟为XVF3000核心（Tile 0 和Tile 1）处理音频传输协议需要的音频时钟，XVF3000核心将12.288 MHz进行分频，分别生成I2S 的 LRCLK , BCLK 和 PDM 协议的CLK。 所以12.288 MHz作为MCLK分别输入到XVF3000 的pin 62(芯片定义该引脚为X0D12，即Tile 0的1E 端口) 和 pin 20（芯片定义该引脚为X1D38,即 Tile 1的1o端口）\nXTAG接口为XMOS专用的调试和烧录工具，XVF3000内置了QSPI Flash（IS25LP016D），XVF3000需要下使用XTAG烧录factoy固件了后，XVF3000才能正常运行麦克风阵列算法，在原理设计时，需要引出XTAG和QSPI Flash的烧录接口，以便样机或者量产时烧录XVF3000固件。\nXVF3000外部需要有个复位检测芯片，避免供电电压不正常时导致固件运行紊乱，根据datasheet的描述，其复位时间必须为1ms~10ms之间的拉低时间\n If your design is powered by VBUS,then RST_N should go high within 10 ms of attaching to VBUS in order to ensure that USB timings are met. RST_N should be at least 1 ms after VDDIO good to enable the built-in flash to settle.\n 其整体设计为, 其中：\n XTAG 建议接一个2x5 1.27mm的母座端子引出，方便烧录和调试,且脚位排序不变 flash point是引出使用QSPI Flash烧录器进行PCBA的方式烧录测试点。烧录前需要接5V和GND，并且RST_N拉低以确保XVF3000在烧录过程中处于复位状态。如果不是PCBA的烧录方式，不需要保留flash point这些测试点 XVF3000 pin 27需要上拉1K电阻, 确保XVF3000上电时访问的是内部的QSPI Flash 12.288 MHz有源晶振时钟分出3路时钟，分别提供Tile 0，Tile 1和Codec作为MCLK使用，如果PCBA板子布线较长，建议加个buffer logic器件加以增大驱动能力  音频I/O XVF3000 支持多路PDM麦克风，但是XMOS官方vocal Fusion算法仅支持4路麦克风阵列算法。多路PDM麦克风接口复用1个clk 时钟信号线，以确保多路麦克风信号高一致性。多路麦克风data信号线各自独立，不分L/R时序。L\nXVF3000 支持2路I2S 接口，其I2S协议为标准I2S, 64fs, 有效位可以实现16bit/24bit。 如果I2S连接ADC或者DAC, 则XVF3000 的I2S为master模式 ; 如果XVF3000 连接蓝牙/wifi/CPU, 则XVF3000都可以选择master/slave模式。两路I2S都复用MCLK , LRCLK , BCLK。\n其中XVF3000的音频接口PDM和I2S的时钟频率为：\nPDM_CLK: 3.072 MHz\nI2S_MCLK: 12.288 MHz\nI2S_BCLK: 1.024 MHz(@16KHz sample rate) I2s_LRCLK: 16 KHz(@16KHz sample rate)\nXVF3000的DAC和ADC选型设计，根据用户项目框架的需要，参考本站XVF3000项目实施落地的应用框架而确定是否都需要ADC和DAC的设计。XVF3000仅支持mono AEC（单声道 回音消除），在DAC或者ADC设计时，仅需要使用DAC的右声道输出（Right channel output）和ADC的右声道输入（Right channel input）。\n选择相应的DAC和ADC需要吻合XVF3000的I2S时序，且尽量免I2C配置，为I2S自适应的Codec，避免XVF3000固件有过多的I2C配置造成软件工程师过多投入。\n其整体设计如下图，其中\n  每个所用到的I/O都是XVF3000软件定义，由于需要配合现成的固件，所以I/O不建议更换\n  4个PDM 麦克风的LR 都需要统一拉低接地。如成本允许，单独生成3V3A干净电源提供给麦克风供电。\n  PXVF3000-KIT评估板麦克风布局为32mm的半径圆形均匀分布，如需其他圆形尺寸，麦克风的间距不小于30 mm,其最大间距由TTL受干扰限制，不建议太大，XVF3000 I/O驱动能力仅为4mA。如更改了圆形尺寸，需要通知固件方修改软件以匹配阵型\n  用户根据项目框架需要是否DAC，XVF3000仅支持mono AEC, 且DAC在右通道输出（Right channel output）\n  用户根据项目框架需要是否ADC，XVF3000仅支持mono AEC, 且ADC在右通道输入（Right channel input）,并且模拟参考信号（analog AEC ref）在播放的运放前端接入，同时建议设计分压电路，查看ADC的满框输入水平（Full Scale Input Level ）,以确定分压值\n  用户尽量选择免I2C配置的ADC和DAC，选择I2S自适应的Codec，则不需要通知固件方进行I2C配置来吻合XVF3000的I2S协议和驱动Codec\n  控制I/O XVF3000固件内部仍有小些逻辑控制资源，可以实现控制LED，按键等功能。LED的控制主要是为了实现XVF3000圆形麦克风阵列DOA（声源定位）和VAD(人声检测)指示使用，XVF3000仅支持12个LED来显示360度方位，分辨率为30度。固件的麦克风阵列算法精度取决于4路麦克风阵列信号的一致性以及阵列麦克风的几何坐标参数是否在固件有足够精准。\n按键控制建议仅用在麦克风的静音（MUTE信号）。如功能上需要用到麦克风静音功能，建议在4路PDM复用的CLK引脚加上逻辑器件，实现电气上的静音。\n其整体设计如下图，其中\n  LED12为VAD（人声检测）指示使用，建议单独放在圆形中间或者靠边地方，LED[0`11]为角度方位使用，并且建议顺时针圆形分布，需要告知固件方使能VAD且修改固件实现正确的方位指示。如不需要LED指示，可全部去掉\n  MIC_CLK拉高拉低都可以实现麦克风信号静音（MUTE）,这里建议用户增加逻辑logic器件来实现物理上MUTE。不建议在XVF3000固件来时间音量+，音量—，会涉及投入比较大的固件开发。如需要，建议直接控制运放。\n  检查表 Check List 框架检查  USB 需要做保留设计，无论是是否有使用I2S作为音频传输，USB的dfu_usb和vfctrl_usb仍需要使用 XVF3000的XTAG设计建议使用2x5母座端子，间距1.27mm；或者2x10的2.54mm的母端子，避免留出测试点接线麻烦的方式。木瓜电子可提供转接板，同时用户需要购买XTAG烧录器 XVF3000内置了QSPI Flash，需要考虑到批量生产的烧录操作，设计前需要确定好是选择PCBA烧录还是裸片烧录，以便留出flash point相关测试点，同时确保使用QSPI flash烧录方式QE=1的配置烧录 确认好AEC ref的提供给XVF3000的方式，以便确认是否ADC和DAC  原理图和PCB检查  查阅XVF30000的datasheet的Check list(page 72) 查阅XVF30000的VocalFusion Speaker Hardware Manual.pdf 复位芯片是必须要的，可以选择侦测3V3和1V0 麦克风layout布局，建议每个麦克风间距不小于30mm Layout时，USB型号尽量并行走线且不靠近I2S/PDM的时钟线 Layout时，需要考虑量产时，麦克风需要加上密封胶套来配合结构外壳，达到声学要求  PCBA问题排查 USB不能正常枚举出声卡设备\n 确认硬件的电源3V3和1V0是否正常; 确认24 MHz时钟正常进入XVF3000; 确认复位检查芯片是否拉住了XVF3000的复位 确认XVF3000是否已有固件；确认使用QSPI Flash烧录器烧录固件时，配置QE=1，并且烧录时已把配置烧录进去。XVF3000已烧录固件时，板载5V电源会在大于150mA  判断麦克风是否良好\n 烧录或者dfu_usb一个6通道固件，把麦克风原始信号在audactiy录制查看，或者使用AP分析  AEC 性能不好\n 如是模拟参考信号到ADC提供给XVF3000的方式，确认ADC接收到的模拟参考信号是否正常，是否为右声道输入，是否有作为分压输入水平不超过ADC的满框输入水平 如是USB提供参考信号给XVF3000的方式，确认是否是右声道输出给喇叭。 确认整个过程中喇叭和麦克风的相对位置没有任何变动 确认喇叭到麦克风声压不大于100dB 确认麦克风有足够好的密封性  服务 XVF3000的硬件设计用户需要自行完成，结合木瓜电子提供的参考原理图设计（PXVF3000-KIT 评估板），XVF3000 datasheet和VocalFusion Speaker Hardware Manual文档完成设计。\n木瓜电子可以为用户提供XVF3000 固件，整体设计如有技术问题，可以发邮件发pxvf3000@pawpaw.hk咨询。\n木瓜电子可以提供XMOS XVF3000 , 麦克风和Code芯片供应服务。\n","description":"介绍XVF3000硬件设计，涉及到sch和PCB方面的内容，包含XVF3000最小系统，AEC的ADC，DAC设计，4路麦克风阵列摆放，以及麦克风阵列量产指导","id":4,"section":"docs","tags":null,"title":"XVF3000硬件设计","uri":"http://docs.pawpaw.ltd/docs/pxvf3000-kit/xvf3000_hw_deseign/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3000-KIT 已详细了解XVF3000 内置的前端算法AEC , BF , NS, AGC等 已使用PXVF3000-KIT已经通过vfctrl_usb工具调试出理想的参数 已确认XMOS XVF3000 4路麦克风阵列方案性能可满足导入项目产品中  概要 使用XVF3000作为圆形4麦阵列方案的主控，需要了解硬件设计和软件设计，结合结构设计，才能使得产品顺利落地。并且根据我司现有的XMOS麦克风阵列方案，建议使用XVF3000来做桌面会议产品(Comms 方向)\n如需要做语音识别（ASR方向）建议使用我们2麦阵列方案XVF3510方案。 XVF3000项目导入前，根据下文的描述需要了解以下几点:\n XVF3000的硬件框架的确定 熟悉USB的对产测和测试的作用 XVF3000的固件获取, 烧录和更新 XVF3000 DSP算法参数 麦克风阵列的外壳结构的声学设计 XVF3000的产测需具备的设备和测试的流程 XVF3000过认证需要提前准备的工作  XVF3000 硬件基本框架 XVF3000芯片基本特性如下:\n 商用温度等级（0 °C to 70 °C） TQ128 封装 580mA典型工作电流，700mW左右（固件运行） 内置了16Mbit QSPI Flash I/O 驱动能力为4mA 订购型号：XVF3000-TQ128-CA； 丝印：VSM01C  XVF3000 硬件系统最小系统如下图。XVF3000 圆形4路麦克风阵列根据音频传输接口的不同，大体分为如下三种硬件框架。用户根据项目需求选择其一，并且以确定硬件上是否需要设计ADC和DAC。\n使用USB连接Host | USB_in\u0026amp;out Host主机的音频传输都通过XVF3000的USB来输入输出，XVF3000作为一个USB Audio声卡设备，产品应用一般为外置的拾音设备。\n其框架如下图，其中：\n XVF3000前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host播放声音时通过USB声卡播放输出，XVF3000为声卡设备，XVF3000的AEC参考信号在USB协议音频传输过程中获取 XVF3000 USB UAC1.0包含传输音频输入输出、vfctrl_usb和dfu_usb，UAC输入输出的音频格式为16KHz/48KHz\n  使用USB连接Host | Analog_ref XVF3000通过USB输入声音给host主控，Host主控提供模拟AEC参考信号给XVF3000。\n其框架如下图，其中：\n XVF3000前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host提供播放声音的参考信号给XVF3000做回音消除的参考信号，ADC采集Host端的模拟声音传输给XVF300 XVF3000 USB UAC1.0包含传输音频输入、vfctrl_usb和dfu_usb，UAC输入的音频格式为16KHz/48KHz  使用I2S连接Host| I2S_in\u0026amp;out 该框图不常用，仅推荐XVF3000需要连接WiFi/蓝牙时使用，并且建议Host(无线模组)的I2S需要做I2S slave模式，因为XVF3000需要音频时钟做16KHz的音频算法处理\n其框图如下图，其中：\n XVF3000前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过I2S接口输入给Host Host提供播放声音的参考信号给XVF3000做回音消除的参考信号，Host通过I2S传输给XVF3000 I2S协议要求16KHz/48KHz 16bit，64fs, 标准I2S，其两路I2S共用时钟线MCLK，BCLK，LRCLK 预留USB接口，方便工程样机的调试和产测。  XVF3000 固件基本框架 ASR 和 Comms 的选择 XVF3000 固件麦克风阵列算法DSP 运行后，可同时提供两路前端处理后的声音信号输出，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。用户根据产品需求，可以选择ASR信号和Comms信号同时输出，或者选择其中一个输出。\nASR\nASR信号主要是用于语音识别，接入类似Alexa等各大语音识别引擎平台，做语音交互使用。ASR信号整体的特征是人声清晰，频谱比较丰满，降噪系数较小，以满足语音高识别率。\nComms\nComms信号主要是用于会议通话使用，类似接入微软的teams, skype和企业微信或者钉钉等会议产品使用。Comms信号整体的特征是底噪比较小，由于降噪系数比较大，其频谱比较干净明显。\nAEC参考信号选择 XVF3000仅支持mono（单声道）参考信号，固件中默认选择立体声中的右声道(Right channel)作为AEC的参考信号，所以产品中的喇叭建议使用1个喇叭，或者2个喇叭都由右声道(Right channel)输出。AEC回音消除所需要的参考信号有两种方式提供给XVF3000\n选择 USB UAC 提供AEC参考信号\nUSB UAC作为声卡播放的时候，播放的声音信号经过XVF3000时，XVF3000已经copy了参考信号提供给AEC算法模块使用。但是，后级的DAC和功放都需要保持线性输出，喇叭播放出的声音不能有EQ处理。如有EQ处理，则喇叭播放出来的声音跟已提供的参考信号已经失去了线性的对比，结果会导致AEC性能发挥不好。\n选择 I2S(ADC)模拟提供AEC参考信号\n需要增加I2S接口接入数字参考信号或者增加ADC接入模拟参考信号提供给XVF3000 AEC算法模块使用。建议在功放前选择右声道型号提供给ADC。同理，功放后级不能有EQ处理。\n烧录方式的选择 XVF3000芯片可以使用XMOS专用XTAG进行烧录，也可以使用QSPI flash 烧录器进行PCBA烧录和裸片烧录factory固件。同时可以通过dfu_usb工具更新dfu固件。根据产线实际情况，进行评估和选择。\n木瓜电子通常会提供3种后缀命名的固件，分别为xxx.xe, xxx_factory.bin和xxx.dfu。这三者中，xxx.xe和xxx_factory.bin都统称为factort固件，xxx.dfu称为更新固件。其中\n xxx.xe固件由XMOS IDE编译生成，仅能通过XTAG调试工具烧录到XVF3000芯片，其烧录时间上，效率很低。 xxx_factory.bin固件由xxx.xe通过XMOS IDE导出，仅能通过spi flash烧录器烧录，效率较高。 xxx.dfu更新固件由xxx.xe通过XMOS IDE结合QSPI Flash型号信息来导出，仅能通过USB dfu_usb工具进行更新固件。更新固件后，需要重启XVF3000才会正常运作更新后的固件。  使用dfu_usb工具进行更新固件的前提是:XVF3000已经烧录了factory固件，XVF3000能够正常运作，USB能够在操作系统枚举成功， xxx.xe的烧录方式 用户需要拥有XMOS的专用XTAG调试工具，并且下载和安装xTimecomposer IDE。\n运行其Command prompt 工具，确保上电XVF3000硬件和接好XTAG，键入指令如下, Enter键后，查看XVF3000和XTAG是否握手成功\n1  xflash -l   键入类似如下的XTAG指令，Enter键后烧录完毕即可\n1  xflash xxx.xe   xxx_factory.bin的烧录方式 无论是XVF3000板载烧录还是裸片烧录，都需要留出XVF3000的flash point，以便spi flash烧录器能够访问XVF3000内置的QSPI Flash。同时需要确保XVF3000的3V3和1V0供电正常，并且XVF3000的RST_N引脚提前拉低，确保XVF3000在整个烧录过程处于复位状态\n用户需要拥有支持QSPI Flash芯片的flash烧录器，在其上位机选择使用QE=1的烧录方式，操作参考下图：\n 检测芯片型号或者选择IS25LP016D(旧版本的XVF3000内置flash的信号为IS25LQ16B) 加载xxx_factoy.bin固件 打开配置选项 选择QE=1,后确定 勾选写入配置 开始烧录  固件开发 木瓜电子可以为用户提供factory固件和DFU更新固件，用户采购一些XVF3000样品，可以申请由木瓜电子预烧录factory固件，在样机阶段，都可以使用DFU进行更新固件。\n如用户需要整个固件源代码，可以在XMOS官网下载，或者发邮件到pxvf3000@pawpaw.hk向木瓜电子申请。提供源代码之后，客户结合文件包内的文档和XMOS官方的文档自行编程，木瓜电子不考虑在XVF3000的代码问题上提供技术解答。\n声学要求 XVF3000 圆形麦克风阵列的DSP性能跟声学和结构设计有很大关系。在硬件设计前，须提前先了解声学设计的要求。PDM MEMS麦克风有两种拾音孔，分为顶部拾音和底部拾音，这两种麦克风的声学电气特性几乎一致。XVF3000 算法对麦克风电气参数要求不高，通常选择的特性在如下范围左右即可\n Sensitivity: -26 dB FS SNR: 64 dBA AOP: 120 dB SPL  麦克风密封性 密封主要是为了确保麦克风的拾音孔仅在结构外壳的拾音腔孔获取外界的声音，避免声音进入到结构内部来回反射产生较严重的混响。声学设计参考下图\n在硬件设计时，需要提前考虑麦克风的密封性的设计，通常产品是增加密封胶套来实现密封性能，并且在硬件上需要预留密封胶套的位置以吻合产品结构声学需求。\n麦克风避震性 避震主要是为了喇叭播放声音时音腔产生的震动不传导到麦克风板，进而避免影响麦克风的拾音。建议在设计喇叭音腔跟麦克风有足够的距离，并且有绝对的隔绝。\n麦克风声压 麦克风的AOP通常在120 dB左右，如果声音信号超过该值，则会导致麦克风拾音出现截幅，导致声音失真。\nXVF3000的AEC性能做到最高50dB抑制，建议喇叭的声音在麦克风端录音不超过100dB。 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。体现的结果是AEC性能不好\n喇叭和麦克风尽量避免同一朝向，建议形成90度或者180度的朝向\n麦克风一致性 4路麦克风拾音信号需要保持高一致性，在组装结构外壳是，需要统一录制4路麦克风原始信号，进行分析去一致性，重点是体现在幅值和频谱特性。\n4路麦克风信号的一致性要求为整个XVF3000项目的基本要求，阵列麦克风才能发挥其应有的性能\n产线测试 XVF3000导入试产量产阶段,须要确认产线具备XVF3000烧录以及录音测试。设计XVF3000烧录固件的治具,预留出的flash point能够访问XVF3000进行flash写入。建议使用6通道的固件, 确保4个麦克风正常运作,以及做信号一致性分析。\n ch0:Comms; ch1:mic0; ch2:mic1; ch3:mic2; ch4:mic3; ch5: mono aec_ref\n 在确定无硬件问题之后,使用dfu_usb更新最终的1通道或者2通道的dfu固件以实现最终产品。\n ch0:Comms; ch1:ASR\n 产品过认证 XVF3000解决方案能够通过Alexa 的ASR认证和微软的Skype等Comms认证。如产品确定需要过认证, 在产品处于basic版本时, 用户需要有足够熟悉和了解XVF3000 DSP的参数以及阵列的各项知识。根据认证产商的要求, 在产品调整XVF3000 DSP参数以实现过认证。由于每个产品的声学结构都会影响XVF3000 DSP参数的指示, 所以木瓜电子无法在认证方面提供XVF3000 的DSP 参考值,并且不参与整个过认证流程。\n","description":"XVF3000项目导入落地实施步骤，了解硬件设计，固件设计，功能选择，以及量产测试等指引","id":5,"section":"docs","tags":null,"title":"XVF3000项目导入","uri":"http://docs.pawpaw.ltd/docs/pxvf3000-kit/xvf3000_project_import/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了pxvf3500-KIT 已详细了解XVF3500 内置的前端算法AEC , BF , NS, AGC等 已使用pxvf3500-KIT已经通过vfctrl_usb工具调试出理想的参数 已确认XMOS XVF3500 4路麦克风阵列方案性能可满足导入项目产品中  概要 使用XVF3500作为线条形4麦阵列方案的主控，需要了解硬件设计和软件设计，结合结构设计，才能使得产品顺利落地。并且根据我司现有的XMOS麦克风阵列方案，建议使用XVF3500来做视频通话产品(Comms 方向)\n如需要做语音识别（ASR方向）建议使用我们2麦阵列方案XVF3510方案。 XVF3500项目导入前，根据下文的描述需要了解以下几点:\n XVF3500的硬件框架的确定 熟悉USB的对产测和测试的作用 XVF3500的固件获取, 烧录和更新 XVF3500 DSP算法参数 麦克风阵列的外壳结构的声学设计 XVF3500的产测需具备的设备和测试的流程 XVF3500过认证需要提前准备的工作  XVF3500 硬件基本框架 XVF3500芯片基本特性如下:\n 商用温度等级（0 °C to 70 °C） FBGA 167 封装 685mA典型工作电流，1W左右（固件运行） I/O 驱动能力为4mA 订购型号：XVF3500-FB167-C； 丝印：VSM05C  XVF3500 硬件系统最小系统如下图。XVF3500 线形4路麦克风阵列根据音频传输接口的不同，大体分为如下三种硬件框架。用户根据项目需求选择其一，并且以确定硬件上是否需要设计ADC和DAC。\n使用USB连接Host | USB_in\u0026amp;out Host主机的音频传输都通过XVF3500的USB来输入输出，XVF3500作为一个USB Audio声卡设备，产品应用一般为外置的拾音设备。\n其框架如下图，其中：\n XVF3500前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host播放声音时通过USB声卡播放输出，XVF3500为声卡设备，XVF3500的AEC参考信号在USB音频播放传输过程中获取 XVF3500 USB UAC1.0包含传输音频输入输出、vfctrl_usb和dfu_usb，UAC输入输出的音频格式为16KHz/48KHz\n  使用USB连接Host | Analog_ref XVF3500通过USB输入声音给host主控，Host主控提供模拟AEC参考信号给XVF3500。\n其框架如下图，其中：\n XVF3500前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过USB接口输入给Host Host提供播放声音的参考信号给XVF3500做回音消除的参考信号，ADC采集Host端的模拟声音传输给XVF300 XVF3500 USB UAC1.0包含传输音频输入、vfctrl_usb和dfu_usb，UAC输入的音频格式为16KHz/48KHz  使用I2S连接Host| I2S_in\u0026amp;out 该框图不常用，仅推荐XVF3500需要连接WiFi/蓝牙时使用，并且建议Host(无线模组)的I2S需要做I2S slave模式，因为XVF3500需要音频时钟做16KHz的音频算法处理\n其框图如下图，其中：\n XVF3500前端信号处理完后，提供干净的声音(Comms/ASR)给Host进行会议通话，通过I2S接口输入给Host Host提供播放声音的参考信号给XVF3500做回音消除的参考信号，Host通过I2S传输给XVF3500 I2S协议要求16KHz/48KHz 16bit，64fs, 标准I2S，其两路I2S共用时钟线MCLK，BCLK，LRCLK 预留USB接口，方便工程样机的调试和产测。  XVF3500 固件基本框架 ASR 和 Comms 的选择 XVF3500 固件麦克风阵列算法DSP 运行后，可同时提供两路前端处理后的声音信号输出，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。用户根据产品需求，可以选择ASR信号和Comms信号同时输出，或者选择其中一个输出。\nASR\nASR信号主要是用于语音识别，接入类似Alexa等各大语音识别引擎平台，做语音交互使用。ASR信号整体的特征是人声清晰，频谱比较丰满，降噪系数较小，以满足语音高识别率。\nComms\nComms信号主要是用于会议通话使用，类似接入微软的teams, skype和企业微信或者钉钉等会议产品使用。Comms信号整体的特征是底噪比较小，由于降噪系数比较大，其频谱比较干净明显。\nAEC参考信号选择 XVF3500支持立体声(stereo)AEC ,所以需要左声道和右声道的同时输入给XVF3500作为AEC的参考信号。AEC回音消除所需要的参考信号有两种方式提供给XVF3500\n选择 USB UAC 提供AEC参考信号\nUSB UAC作为声卡播放的时候，播放的声音信号经过XVF3500的时候，XVF3500已经copy了参考信号提供给内部AEC算法模块使用。但是，后级的DAC和功放都需要保持线性输出，喇叭播放出的声音不能有EQ处理。如有EQ处理，则喇叭播放出来的声音跟已提供的参考信号已经失去了线性的对比，结果会导致AEC性能发挥不好。\n选择 I2S(ADC)模拟提供AEC参考信号\n需要增加I2S接口接入数字参考信号或者增加ADC接入模拟参考信号提供给XVF3500 AEC算法模块使用。建议在功放前提供左右声道信号提供给ADC。同理，功放后级不能有EQ处理。\n烧录方式的选择 XVF3500芯片需要外置QSPI Flash来存储固件，XVF3500上电读取QSPI Flash的固件后，便不再需要继续读取QSPI Flash的内容，XVF3500可以使用XMOS专用XTAG进行烧录，也可以使用flash 烧录器进行QSPI Flash 芯片烧录XVF3500的factory固件。同时可以通过dfu_usb工具更新dfu固件。根据产线实际情况，进行评估和选择。\n木瓜电子通常会提供3种后缀命名的固件，分别为xxx.xe, xxx_factory.bin和xxx.dfu。这三者中，xxx.xe和xxx_factory.bin都统称为factort固件，xxx.dfu称为更新固件。其中\n xxx.xe固件由XMOS IDE编译生成，仅能通过XTAG调试工具烧录到XVF3500芯片，其烧录时间上，效率很低，调试时可使用 xxx_factory.bin固件由xxx.xe通过XMOS IDE导出，仅能通过spi flash烧录器烧录，效率较高，量产推荐使用 xxx.dfu更新固件由xxx.xe通过XMOS IDE结合QSPI Flash型号信息来导出，仅能通过USB dfu_usb工具进行更新固件。更新固件后，需要重启XVF3500才会正常运作更新后的固件。  使用dfu_usb工具进行更新固件的前提是:XVF3500已经烧录了factory固件，XVF3500能够正常运作，USB能够在操作系统枚举成功， xxx.xe的烧录方式 用户需要拥有XMOS的专用XTAG调试工具，并且下载和安装xTimecomposer IDE。\n运行其Command prompt 工具，确保上电XVF3500硬件和接好XTAG，键入指令如下, Enter键后，查看XVF3500和XTAG是否握手成功\n1  xflash -l   键入类似如下的XTAG指令，Enter键后烧录完毕即可\n1  xflash xxx.xe --spi-spec xx_flash.spec   xxx_factory.bin的烧录方式 建议直接烧录flash芯片，尽量避免PCBA烧录flash芯片。直接烧录flash芯片是最高效，且良率最高。\n用户需要拥有支持QSPI Flash芯片的flash烧录器，在其上位机选择使用QE=1的烧录方式，类似操作参考下图：\n 检测芯片型号或者选择GD25Q16C(其他的QSPI flash芯片也可以,不够需要结合芯片型号导出xxx_factory.bin) 加载xxx_factoy.bin固件 打开配置选项 选择QE=1,后确定 勾选写入配置 开始烧录  固件开发 木瓜电子可以为用户提供factory固件和DFU更新固件，用户采购一些XVF3500样品，可以申请由木瓜电子预烧录factory固件的QSPI flash芯片，在样机阶段，都可以使用DFU进行更新固件。\n如用户需要整个固件源代码，可以在XMOS官网下载，或者发邮件到pxvf3500@pawpaw.hk向木瓜电子申请。提供源代码之后，客户结合文件包内的文档和XMOS官方的文档自行编程，木瓜电子不考虑在XVF3500的代码细节问题上提供技术解答。\n声学要求 XVF3500 线形麦克风阵列的DSP性能跟声学和结构设计有很大关系。在硬件设计前，须提前先了解声学设计的要求。PDM MEMS麦克风有两种拾音孔，分为顶部拾音和底部拾音，这两种麦克风的声学电气特性几乎一致。XVF3500 算法对麦克风电气参数要求不高，通常选择的特性在如下范围左右即可\n Sensitivity: -26 dB FS SNR: 64 dBA AOP: 120 dB SPL  麦克风密封性 密封主要是为了确保麦克风的拾音孔仅在结构外壳的拾音腔孔获取外界的声音，避免声音进入到结构内部来回反射产生较严重的混响。声学设计参考下图\n在硬件设计时，需要提前考虑麦克风的密封性的设计，通常产品是增加密封胶套来实现密封性能，并且在硬件上需要预留密封胶套的位置以吻合产品结构声学需求。\n麦克风避震性 避震主要是为了喇叭播放声音时音腔产生的震动不传导到麦克风板，进而避免影响麦克风的拾音。建议在设计喇叭音腔跟麦克风有足够的距离，并且有绝对的隔绝。\n麦克风声压 麦克风的AOP通常在120 dB左右，如果声音信号超过该值，则会导致麦克风拾音出现截幅，导致声音失真。\nXVF3500的AEC性能做到最高50dB抑制，建议喇叭的声音在麦克风端录音不超过100dB。 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。体现的结果是AEC性能不好\n喇叭和麦克风尽量避免同一朝向，建议形成90度或者180度的朝向\n麦克风一致性 4路麦克风拾音信号需要保持高一致性，在组装结构外壳是，需要统一录制4路麦克风原始信号，进行分析去一致性，重点是体现在幅值和频谱特性。\n4路麦克风信号的一致性要求为整个XVF3500项目的基本要求，阵列麦克风才能发挥其应有的性能\n产线测试 XVF3500导入试产量产阶段,须要确认产线具备QSPI Flash芯片的烧录以及录音测试。建议使用8通道的factoy固件, 确保4个麦克风正常运作,以及做信号一致性分析。\n ch0:Comms; ch1:ASR; ch2:mic0; ch3:mic1; ch4:mic2; ch5: mic3 ch6: aec_ref_l;ch7: ace_ref_r\n 在确定无硬件问题之后,再使用dfu_usb工具更新最终的1通道或者2通道的dfu固件以实现最终产品。\n ch0:Comms; ch1:ASR\n 产品过认证 XVF3500解决方案能够通过Alexa 的ASR认证和微软的Skype等Comms认证。如产品确定需要过认证, 在产品处于basic版本时, 用户需要有足够熟悉和了解XVF3500 DSP的参数以及阵列的各项知识。根据认证平台商的要求, 在产品调整XVF3500 DSP参数以实现过认证。由于每个产品的声学结构都会影响XVF3500 DSP参数的指示, 所以木瓜电子无法在认证方面提供XVF3500 的DSP 参考值,并且不参与整个产品过认证流程。\n","description":"XVF3500项目导入落地实施步骤，了解硬件设计，固件设计，功能选择，以及量产测试等指引","id":6,"section":"docs","tags":null,"title":"XVF3500项目导入","uri":"http://docs.pawpaw.ltd/docs/pxvf3500-kit/xvf3500_project_import/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3000-KIT 已获取到PXVF3000-KIT的资料包 已能够进行使用dfu_usb和vfvtrl_usb工具， 已详细了解XMOS 的XVF3000-3100-DSP-Databrief文档 已详细了XVF3000 内置的前端算法AEC , BF , NS, AGC等  下文将不再对XVF3000-3100-DSP-Databrief里的专业术语进行解释，重点是描述DSP参数的意义和数值的方向\nPXVF3000-KIT DSP 初始参数 PXVF3000-KIT 使用XVF3000-3100-DSP-Databrief的默认参数，可以通过查阅文档和使用vfctrl_usb 可以读取PXVF3000-KIT的DSP参数。且PXVF3000-KIT每次重新上电，所有DSP 参数都重置为初始值\n1  vfctrl_usb HPFONOFF   其重新上电后首次打印输出的内容为初始值,\n1  HPFONOFF:1   其他参数使用vfctrl_usb工具读取方式同理\n查阅文档XVF3000-3100-DSP-Databrief的从page 15开始的参数描述中可以获取初始参数\nDSP 参数写入和认证 使用vfctrl_usb 工具进行写入DSP 参数，如键入指令：\n1  vfctrl_usb HPFONOFF 2   PXVF3000-KIT可以实时更改HPFONOFF参数为2，并且打印输出如下，\n1  HPFONOFF:2   键入指令时需要注意空格的输入，同时查阅XVF3000-3100-DSP-Databrief里HPFONOFF描述的的范围为[0..3] ，其值的类型为INT型(整数型)。\n确认写入完成了后，可以使用audaciy或者其他录音软件实时查看vfctril_usb工具修改DSP参数的效果。同时建议使用系统声卡监听功能进行实时侦听修改效果。使用3.5mm耳机插入PC电脑的耳机孔后，参考下图，进行如下操作，\n 在录音栏项，右键 XMOS VocalFusion Spk(UAC1.0) -\u0026gt; 点击属性 选中侦听此设备 在通过此设备中播放下拉栏中-\u0026gt;选择PC电脑内置的播放声卡 必须使用耳机插入PC的3.5mm耳机口进行侦听，否正会产生啸叫  DSP 参数简单介绍 HP 高通滤波 XVF3000-3100-DSP-Databrief文档描述的高通滤波器仅有一组参数HPFONOFF，其最高值为是180Hz，如将PXVF3000-KIT作为会议设备（Comms输出）使用，建议设置HPFONOFF为3。如作为语音识别（ASR）,该值可以使用初始值\n1  vfctrl_usb HPFONOFF 3   AEC 回音消除 PC电脑将XMOS VocalFusion Spk（UAC 1.0）作为播放设备时，电脑声音播放则通过PXVF3000-KIT Line-out接口（3.5mm耳机孔）播放输出，后级需要接一个有源音箱，并且有源音箱是必须是线性放大，不能存在EQ处理。\nPXVF3000-KIT的AEC ref参考信号则由UAC1.0播放时，经过XVF3000就已经拷贝AEC参考信号提供给XVF3000 的AEC 算法模块。\nAECFREEZEONOFF\n查看到AECFREEZEONOFF的初始值为0，意味着改变有源音箱到PXVF3000-KIT的距离或者路径，XVF3000的AEC性能可以通过少些时间自适应恢复。如产品已经有结构，并且保持了音箱（喇叭）和XVF3000 4路麦克风相对位置没有任何改变，可以设置为1，以确保产品的AEC性能\n1  vfctrl_usb AECFREEZEONOFF 1   AECFREEZEONOFF与AECPATHCHANGE参数有关联，如XVF3000检测到音箱（喇叭）和XVF3000 4路麦克风相对位置已改变，明显出现的现象是AEC性能很差，可以使用vfctrl_usb读出AECPATHCHANGE 为1时，则说明位置已改变。\nACE 其他\n其他参数需要结合产品接口调整，如作为简单测试，则兼容PXVF3000-KIT无需调整其他参数\n需要了解XVF3000的AEC性能最高为50dB抑制，确保喇叭的声压到达PXVF3000-KIT的尽量小于100dBA, 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。\nAGC 自动增益 AGCONOFF为AGC的总开关，初始值为1。使用vfctrl_usb工具能够实时读出AGC的增益值AGCGAIN,同时能够修改实时写入修改AGCGAIN的值。\n1  vfctrl_usb AGCGAIN   1  vfctrl_usb AGCGAIN 100   AGCGAIN的值为实时变化，其主要是围绕着AGCDESIREDLEVEL这个参数。\nAGCDESIREDLEVEL\nAGC重点的调试DSP参数为AGCDESIREDLEVEL，该参数的值决定了ASR / Comms output的整体水平大小，值的选取同时也决定了拾音距离。\n设置AGCDESIREDLEVEL的值为整体ASR / Comms output的信噪比不变，即输出的人声和噪声比例保持线性不变，同时增大，所以建议AGCDESIREDLEVEL不能设置太大，避免引入过大的噪声。\n使用AGCMAXGAIN作为AGC的阈值能够限制AGC无限增大，避免ASR/Comms output的过大，出现截幅和失真。\nNS 噪声抑制 STATNOISEONOFF为稳态噪声抑制开关，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NS 和MIN_NS的调整有效。\nNONSTATNOISEONOFF为非稳态噪声抑制开关，主要是对非规律性或者突如其来的噪声抑制，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NN 和MIN_NN的调整有效。\nGAMMA_NS和GAMMA_NN\nGAMMA_NS和GAMMA_NN这两个参数的值的范围为[0.0 .. 3.0] ，可以理解为评估环境的稳态或者非稳态的噪声量最大值3.0。设置改参数的值，即提供相应比例的噪声量给MIN_NS和MIN_NN设值来实现噪声抑制。\n通常建议参数GAMMA_NS和GAMMA_NN的值不能设置太大，提供过多的噪声量，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nMIN_NS和MIN_NN\nMIN_NS和MIN_NN 可以理解为需要把ASR/Comms output的环境噪声抑制到一个目标底噪，取值范围为[0.0 .. 1.0]，其值越小，则ASR/Comms output的底噪越小。\n该参数受前面参数GAMMA_NS和GAMMA_NN影响，如提供出来的噪声量越多，则MIN_NS和MIN_NN 更容易实现目标值（目标底噪）。\n通常建议参数MIN_NS和MIN_NN的值不能设置太小，过度的噪声抑制，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nASR 参数 DSP参数带有“SR”部分的仅针对ASR信号输出的调试有效，其他基础的参数和Comms信号输出共用。\n","description":"PXVF3000-KIT_dsp_描述，主要介绍XMOS xvf3000芯片内置的圆形麦克风阵列算法及其参数的取值，涉及到如AGC, AEC, Beaforming, NS 等麦克风阵列算法，使用XMOS vfctrol_usb进行调试，","id":7,"section":"docs","tags":null,"title":"PXVF3000-KIT_dsp_描述","uri":"http://docs.pawpaw.ltd/docs/pxvf3000-kit/pxvf3000-kit_dsp_desc/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了PXVF3500-KIT 已获取到PXVF3500-KIT的资料包 已能够进行使用dfu_usb和vfvtrl_usb工具， 已详细了解XMOS 的XVF3500-DSP-Databrief文档 已详细了XVF3500 内置的前端算法AEC , BF , NS, AGC等  下文将不再对XVF3500-DSP-Databrief里的专业术语进行解释，重点是描述DSP参数的意义和数值的方向\nPXVF3500-KIT DSP 初始参数 PXVF3500-KIT 使用XVF3500-DSP-Databrief的默认参数，可以通过查阅文档和使用vfctrl_usb 可以读取PXVF3500-KIT的DSP参数。且PXVF3500-KIT每次重新上电，所有DSP 参数都重置为初始值\n1  vfctrl_usb HPFONOFF   其重新上电后首次打印输出的内容为初始值,\n1  HPFONOFF:3   其他参数使用vfctrl_usb工具读取方式同理\n查阅文档XVF3500-DSP-Databrief的从page 14开始的参数描述中可以获取初始参数\nDSP 参数写入和认证 使用vfctrl_usb 工具进行写入DSP 参数，如键入指令：\n1  vfctrl_usb HPFONOFF 2   PXVF3500-KIT可以实时更改HPFONOFF参数为3，并且打印输出如下，\n1  HPFONOFF:3   键入指令时需要注意空格的输入，同时查阅XVF3500-DSP-Databrief里HPFONOFF描述的的范围为[0..3] ，其值的类型为INT型(整数型)。\n确认写入完成了后，可以使用audaciy或者其他录音软件实时查看vfctril_usb工具修改DSP参数的效果。同时建议使用系统声卡监听功能进行实时侦听修改效果。使用3.5mm耳机插入PC电脑的耳机孔后，参考下图，进行如下操作，\n 在录音栏项，右键 XMOS VocalFusion St(UAC1.0) -\u0026gt; 点击属性 选中侦听此设备 在通过此设备中播放下拉栏中-\u0026gt;选择PC电脑内置的播放声卡 必须使用耳机插入PC的3.5mm耳机口进行侦听，否正会产生啸叫  DSP 参数简单介绍 HP 高通滤波 XVF3500-DSP-Databrief文档描述的高通滤波器仅有一组参数HPFONOFF，其最高值为是180Hz，如将PXVF3500-KIT作为会议设备（Comms输出）使用，建议设置HPFONOFF为3。如作为语音识别（ASR）,该值可以使用初始值\n1  vfctrl_usb HPFONOFF 3   AEC 回音消除 PC电脑将XMOS VocalFusion St（UAC 1.0）作为播放设备时，电脑声音播放则通过PXVF3500-KIT Line-out接口（3.5mm耳机孔）播放输出，后级需要接一个有源音箱，并且有源音箱是必须是线性放大，不能存在EQ处理。\nPXVF3500-KIT的AEC ref参考信号则由UAC1.0播放时，经过XVF3500就已经拷贝AEC参考信号提供给XVF3500 的AEC 算法模块。\nAECFREEZEONOFF\n查看到AECFREEZEONOFF的初始值为0，意味着改变有源音箱到PXVF3500-KIT的距离或者路径，XVF3500的AEC性能可以通过少些时间自适应恢复。如产品已经有结构，并且保持了音箱（喇叭）和XVF3500 4路麦克风相对位置没有任何改变，可以设置为1，以确保产品的AEC性能\n1  vfctrl_usb AECFREEZEONOFF 1   AECFREEZEONOFF与AECPATHCHANGE参数有关联，如XVF3500检测到音箱（喇叭）和XVF3500 4路麦克风相对位置已改变，明显出现的现象是AEC性能很差，可以使用vfctrl_usb读出AECPATHCHANGE 为1时，则说明位置已改变。\nACE 其他\n其他参数需要结合产品接口调整，如作为简单测试，则兼容PXVF3500-KIT无需调整其他参数\n需要了解XVF3500的AEC性能最高为50dB抑制，确保喇叭的声压到达PXVF3500-KIT的尽量小于100dBA, 如超过该值，则大概会有50dB以上的回音残余在输出的信号中，50dB以上残余回音 较为容易被人耳辨识出来。\nAGC 自动增益 AGCONOFF为AGC的总开关，初始值为1。使用vfctrl_usb工具能够实时读出AGC的增益值AGCGAIN,同时能够修改实时写入修改AGCGAIN的值。\n1  vfctrl_usb AGCGAIN   1  vfctrl_usb AGCGAIN 100   AGCGAIN的值为实时变化，其主要是围绕着AGCDESIREDLEVEL这个参数。\nAGCDESIREDLEVEL\nAGC重点的调试DSP参数为AGCDESIREDLEVEL，该参数的值决定了ASR / Comms output的整体水平大小，值的选取同时也决定了拾音距离。\n设置AGCDESIREDLEVEL的值为整体ASR / Comms output的信噪比不变，即输出的人声和噪声比例保持线性不变，同时增大，所以建议AGCDESIREDLEVEL不能设置太大，避免引入过大的噪声。\n使用AGCMAXGAIN作为AGC的阈值能够限制AGC无限增大，避免ASR/Comms output的过大，出现截幅和失真。\nNS 噪声抑制 STATNOISEONOFF为稳态噪声抑制开关，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NS 和MIN_NS的调整有效。\nNONSTATNOISEONOFF为非稳态噪声抑制开关，主要是对非规律性或者突如其来的噪声抑制，初始值为1。STATNOISEONOFF设置为1时，GAMMA_NN 和MIN_NN的调整有效。\nGAMMA_NS和GAMMA_NN\nGAMMA_NS和GAMMA_NN这两个参数的值的范围为[0.0 .. 3.0] ，可以理解为评估环境的稳态或者非稳态的噪声量最大值3.0。设置改参数的值，即提供相应比例的噪声量给MIN_NS和MIN_NN设值来实现噪声抑制。\n通常建议参数GAMMA_NS和GAMMA_NN的值不能设置太大，提供过多的噪声量，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nMIN_NS和MIN_NN\nMIN_NS和MIN_NN 可以理解为需要把ASR/Comms output的环境噪声抑制到一个目标底噪，取值范围为[0.0 .. 1.0]，其值越小，则ASR/Comms output的底噪越小。\n该参数受前面参数GAMMA_NS和GAMMA_NN影响，如提供出来的噪声量越多，则MIN_NS和MIN_NN 更容易实现目标值（目标底噪）。\n通常建议参数MIN_NS和MIN_NN的值不能设置太小，过度的噪声抑制，往往会使得ASR/Comms输出的声音过于失真，扭曲过大。\nASR 参数 DSP参数带有“SR”部分的仅针对ASR信号输出的调试有效，其他基础的参数和Comms信号输出共用。\n","description":"PXVF3500-KIT_dsp_描述，主要介绍XMOS xvf3500芯片内置的线型麦克风阵列算法及其参数的取值，涉及到如AGC, AEC, Beaforming, NS 等麦克风阵列算法，使用XMOS vfctrl_usb进行调试，","id":8,"section":"docs","tags":null,"title":"PXVF3500-KIT_dsp_描述","uri":"http://docs.pawpaw.ltd/docs/pxvf3500-kit/pxvf3500-kit_dsp_desc/"},{"content":"概要 P3510-2MIC是针对XMOS的XK-XVF3510-L71 开发板的硬件升级，优化了硬件设计及布局，更加适合用户直接使用和项目评估。完全兼容XMOS的XK-XVF3510-L71 开发板，所用的DSP芯片为XVF3510.pdf)。XMOS最新更新发布的XVF3510的UA固件完全适用于P3510-2MIC。\nP3510-2MIC为2麦阵列设备，作为前端信号处理，实现语音增强，可同时输出两路前端处理后的声音信号，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。支持使用USB Audio Class 1协议（UAC1.0）传输音频 ，支持所有流行的操作系统（Windows , MAC, Linux和Android），允许作为USB声卡设备枚举接入操作系统中。\nP3510-2MIC内置了立体声回音消除（AEC） , 点噪消除（IC），噪声抑制（NS）和自动增益（AGC）算法，非常有效地实现在远距离和嘈杂环境提高语音识别率和通话质量。使用USB 接口快速接入各种操作系统，同时配套提供了多套固件，非常适用用户迅速接入语音产品中。\n版本    产品版本 修改 发布时间     P3510-2MIC V1 初次发布 2020年10月15日    特点   远距离拾音\n  支持USB Audio Class 1.0 (UAC 1.0)\n  支持USB HID 调试\n  2路麦克风阵列\n  支持3.5mm耳机孔作为模拟AEC参考信号\n  DSP 算法和特点\n· Voice Activity Detection(VAD)\n· Full duplex, stereo, Acoustic Echo Cancellation(AEC)\n· The Automatic Delay Estimation Control (ADEC)\n· Interference Cancellation (IC)\n· Noise Suppression (NS)\n· Automatic Gain Control (AGC)\n  规格   XMOS XVF3510 主控，内置2麦阵列算法\n  2路PDM 数字麦克风：MSM261D4030H1AP\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64 dBA\n  供电：USB 5V 或者FPC 端子\n  尺寸：90mmx18mm\n  模拟AEC参考信号输入\n· ADC: AKM AK5720\n· 3.5mm耳机孔\n  音频传输：\n· USB UAC 1.0 输入输出，AEC可选使用3.5mm耳机孔模拟输入\n· 采样率：16KHz/48KHz（默认）\n  功耗: 5V, 130mA （Max）\n  硬件概述  XMOS DSP ：XVF3510 主控，集成了UAC1.0和2MIC阵列算法，包含了立体声回音消除（AEC） , 点噪消除（IC），噪声抑制（NS）和自动增益（AGC）算法 Micro USB : 提供5V电源，并且传输音频和固件更新，调试 ADC AK5720：外接AEC模拟参考信号时，通过I2S传输参考信号给XVF3510(如果AEC 参考信号不是通过USB提供时使用) Flash AT25SF161:存储XVF3510的固件及数据分区 FPC Header: 作为代替了Micro USB端子选项，10Pin，包含了USB引脚，AEC Ref. ，Mute，Reset等。如使用了Micro USB连接操作系统，则无需使用FPC Header  系统连接框图 引脚映射 FPC Header一般使用不上，因为已经有了Micro USB端子和3.5mm耳机输入端子，FPC Header作为高级选项使用，以便代替Micro USB端子和3.5mm耳机端子，以及要用到Mute和RST时使用\nXMOS JTAG一般使用不上，因为用户需要购买拥有XMOS 专用调试工具XTAG3，且在需要深入开发XVF3510内部固件及factocy烧录时使用\n尺寸 应用场合  导航机器人（ASR） 医疗设备（ASR） 健身设备（ASR） 大屏广告机（ASR） 授课直播（Comms） 摄像头麦克风（Comms）  开始 第一个Demo 通常情况下，用户拿到P3510-2MIC PCBA板后，建议先在Windows系统做初步认证。使用Micro USB 数据线来连接P3510-2MIC和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了P3510-2MIC，并且打开声音控制面板进行设置\n如果没有录制-\u0026gt;立体声混音，可以升级一下声卡驱动，在录制栏目，选择显示禁用的设备；右击立体声混音；选择启用\n由于P3510-2MIC没有播放输出的3.5mm耳机孔，需要将操作系统的默认声卡作为播放输出声卡设备\n 录制和Demo 使用Audacity（点击下载）录音软件在Windows系统进行录音设置，接着使用Audacity录音。\nP3510-2MIC出厂固件USB输出为2ch 48KHz采样率信号，其中ch0为ASR输出，ch1为Comms输出。通常操作系统中默认使用ch0信号作为语音输入用于ASR语音识别引擎。并且用于ASR的信号处理需保留极高的人声频谱，以确保高识别率。\n其他操作系统如MAC OSX和Linux操作系统用法跟Windows类似，文中引用XMOS文档XVF3510 Dev Kit Quick Start_en.pdf进行说明\n MAC OSX\n Open Audio MIDI setup. Click + symbol to add a new device; select Create MultiOutput Device. Select Built-in Output and XVF3510 device. Select new Multi-Output Device in device list. Click at bottom of window to open Options menu; select Use This Device For Sound Output. Select XVF3510 from Master Device drop-down list. Select Drift Correction for Built-in Output. Close Audio Devices window.  LINUX\n  Install paprefs using package manager.\n  Open paprefs and click Simultaneous Output tab.\n  Select Add virtual output device for simultaneous output on all local sound cards option.\n  Close paprefs.\n  Open Terminal; restart pulseaudio server:\n1  pulseaudio -k     Check for the sink named combined.\n1  pactl list sinks     Set combined output as default output.\n1  echo “set-default-sink combined” | pacmd      固件和升级 如果P3510-2MIC的出厂默认固件满足不了用户的配置需求，可以在Firmware中选择其他配套的固件，使用USB数据线连接PC电脑，使用配套提供的DFU(Device Firmware Update)工具进行更新固件。\n安装驱动 Windows系统：\nP3510-2MIC在操作系统中都能识别成XVF3510 (UAC1.0) Adaptive作为声卡输入输出，而Windows系统中的设备管理器显示的XMOS Control需要安装驱动，才能使用XMOS提供的dfu_usb工具进行升级和vfcrtol_usb工具进行DSP 参数控制。使用第三方工具zadig（点击下载）进行驱动安装。\n运行zadig，在列表中选择 XMOS Control (Interface 3)，然后选择 libusb-win32 ，点击 Reinstall Driver。\nLinux系统：不需要安装驱动\nMac 系统：不需要安装驱动\n固件列表 这里配套提供了4个固件，主要是AEC参考提供方式和USB输出音频采样率作为区别，参考下表。如配套的固件仍未满足使用，可以在下面找到解决方式。\n   ID Firmware 采样率 Description     1 data_xvf3510_usb_aec_ref_48K_v4_1_0.dfu 48000Hz 出厂默认固件，使用USB输入输出，同时使用USB提供AEC参考信号，音频格式为48KHz采样率   2 data_xvf3510_I2S_aec_ref_48K_v4_1_0.dfu 48000Hz 使用3.5mm耳机孔接入模拟参考信号，或者是FPC的AEC_R和AEC_L的作为参考信号，音频格式为48KHz采样率   3 data_xvf3510_usb_aec_ref_16K_v4_1_0.dfu 16000Hz 使用USB输入输出，同时使用USB提供AEC参考信号，音频格式为16KHz采样率。   4 data_xvf3510_I2S_aec_ref_16K_v4_1_0.dfu 16000Hz 使用3.5mm耳机孔接入模拟参考信号，或者是FPC的AEC_R和AEC_L的作为参考信号，音频格式为16KHz采样率。    DFU升级 在Windows系统打开cmd命令行终端工具，cd进入P3510-2MIC/Firmware文件夹，键入如下指令或者或者复制其中对于固件的指令进行运行。\n1  dfu_usb --vendor-id 0x20B1 --product-id 0x0014 write_upgrade boot.dfu data_xvf3510_usb_aec_ref_16K_v4_1_0.dfu   执行完之后，打印出一下信息说明固件DFU升级成功\npoll timeout 0 msec\rHAL: read command: GETSTATE (134), 4 bytes\rwrite upgrade successful\rHAL: reboot\rHAL: write command: REBOOT (5), 0 bytes\r其他操作系统如MAC和Linux的使用Terminal，键入指令和打印的内容一致。\n深入使用 在现有的固件仍不能满足用户的现有的需求，可以尝试使用在P3510-2MIC配套提供XMOS官方的原始文件夹（XVF3510-UA-Unqualified-Release_4.1.0rc1），进行线调试和生成用户自己的DFU配置固件（data_xxx.dfu），而这些用户新的需求一般可以列为如下几个分类\n 修改USB枚举信息，如USB 字符串，和USB的VID和PID 修改DSP算法参数，如AGC增益，以更加吻合用户的使用环境，以达到更高的识别率和更远的距离 修改USB输入输出的通道映射，如ch0和ch1都输出ASR信号，AEC的参考信号的提供方式 修改输出音频采样率参数，如修改为16KHz/16bit的音频输出格式  在进行这一部分操作，用户需要认真阅读XMOS的文档资料[XVF3510-User-Guide_4.1的XVF3510-UA部分，才能了解XVF3510的寄存器的参数，以便在线调试和生成DFU配置固件。并且下文描述内容跟XMOS提供的文档一致。\n 以下内容已经假设用户对麦克风阵列的DSP算法，已经有一定的了解，或者根据文档自行了解熟悉，并且了解其DSP参数和数值\nAcoustic Echo Cancellation (AEC)\nAutomatic Delay Estimation \u0026amp; Control (ADEC)\nInterference Cancellation (IC)\nVoice Activity Detection (VAD)\nNoise Suppression (NS)\nAutomatic Gain Control (AGC)\n 在线调试 确保P3510-2MIC的XMOS Control驱动已经安装（仅windows系统需要）\nwindows系统，运行cmd，并且cd进入P3510-2MIC/XVF3510-UA-Unqualified-Release_4.1.0rc1/host/Win32/bin，键入类似指令，便可进行在线调试\n1  vfctrl_usb GET_GAIN_CH0_AGC   打印输出的信息如下：\n1  GET_GAIN_CH0_AGC: 154.3720   其他操作操作系统类似，运行Terminal终端，cd进入对应路径的bin文件夹，并且执行同样的指令便可\nXVF3510里面有很多DSP参数可配置，用户根据XVF3510-User-Guide_4.1.pdf的介绍，可以实现通过USB HID（XMOS Control）进行在线调试参数，由于受P3510-2MIC PCBA的硬件限制，XVF3510-INT部分，XVF3510的I/O和I2C等无法体现效果。其中的可用参数整理在附录里面。\n在线调试的参数仅存在XVF310 RAM内存中， 断电即复位为默认值，如确实需要保存已调试的参数到flash中，需要生成DFU配置固件。 生成DFU配置固件 根据在线调试的参数，保存在XVF3510固件中，以便每次断电保存参数。同时USB枚举描述的参数，需要生成DFU配置固件才能生效，这方面仍需了解如何生成DFU配置固件。根据XVF3510-User-Guide_4.1.pdf的说明，我们抽取出了相应的操作步骤，并且提前生成和提供了boot.dfu文件。\n安装python 3 生成DFU配置固件需要用到python 3工具（推荐v3.7 以上版本，Python 下载连接 http://python.org/downloads.\n在Windows系统上需要自行配置Python的环境变量，运行cmd且键入python已确认是否python已经配置了环境变量。如果没有如下打印，在windows系统的，编辑系统环境变量-\u0026gt;高级-\u0026gt;环境变量-\u0026gt;找到“path”后双击打开-\u0026gt;新建-\u0026gt;复制Python安装路径-\u0026gt;保存确定。\n1 2 3 4  C:\\Users\\qiu\u0026gt;python Python 3.8.5 (tags/v3.8.5:580fbb0, Jul 20 2020, 15:57:54) [MSC v.1924 64 bit (AMD64)] on win32 Type \u0026#34;help\u0026#34;, \u0026#34;copyright\u0026#34;, \u0026#34;credits\u0026#34; or \u0026#34;license\u0026#34; for more information. \u0026gt;\u0026gt;\u0026gt;   生成步骤 在Windows系统上操作时，我们梳理了生成步骤流程，整理出一个批处理文件user_define_dfu_upgrade_cmd.bat\n 路径为：XVF3510-UA-Unqualified-Release_4.1.0rc1/user_define_dfu_upgrade_cmd.bat\n 在双击运行之前批处理文件之前，先在user_define_xvf3510.txt文件编写上在线调试已确定的XVF3510 DSP参数\n 路径为：XVF3510-UA-Unqualified-Release_4.1.0rc1/data-partition/input/user_define_xvf3510.txt\n 保存并双击运行user_define_dfu_upgrade_cmd.bat便可直接使用USB成功升级固件。\n以下是每个步骤解析说明。其中user_define_dfu_upgrade_cmd.bat的内容如下。\n1 2 3 4 5 6 7 8 9 10 11 12 13  cd data-partition python xvf3510_data_partition_generator.py user_define_xvf3510.json cd ../host/Win32/bin dfu_suffix_generator 0x20B1 0x0014 ../../../bin/app_xvf3510_ua_xe_to_dfu_uprade_v410.bin boot.dfu dfu_suffix_generator 0x20B1 0x0014 ../../../data-partition/output/data_partition_upgrade_user_define_xvf3510_v4_1_0.bin data_user_define_dfu_update.dfu dfu_usb --vendor-id 0x20B1 --product-id 0x0014 write_upgrade boot.dfu data_user_define_dfu_update.dfu pause   在user_define_xvf3510.json中已指定访问相对路径*”path“：*为*\u0026ldquo;input/user_define_xvf3510.txt\u0026rdquo;*\n 路径为：XVF3510-UA-Unqualified-Release_4.1.0rc1/data-partition/user_define_xvf3510.json\n 1 2 3 4 5 6 7 8 9 10 11 12  { \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;spispec_path\u0026#34;: \u0026#34;16mbit_12.5mhz_sector_4kb.spispec\u0026#34;, \u0026#34;regular_sector_size\u0026#34;: \u0026#34;4096\u0026#34;, \u0026#34;hardware_build\u0026#34;: \u0026#34;0xFFFFFFFF\u0026#34;, \u0026#34;item_files\u0026#34;: [ { \u0026#34;path\u0026#34;: \u0026#34;input/user_define_xvf3510.txt\u0026#34;, \u0026#34;comment\u0026#34;: \u0026#34;\u0026#34; } ] }   在user_define_xvf3510.txt文件中填写在线调试已确认的XVF3510参数或者需要修改的USB描述信息，类似如下,保存并且关闭。\nSET_DEVICE_TO_USB_RATE 16000\rSET_IO_MAP 5 10\rSET_IO_MAP 4 9\r运行了如下指令后，便会生成输出文件data_partition_upgrade_user_define_xvf3510_v4_1_0.bin在/output/路径中\n1  python xvf3510_data_partition_generator.py user_define_xvf3510.json   利用上面的bin文件进一步生成data_data_user_define_dfu_update.dfu（DFU升级最终需要的配置固件），使用的工具是dfu_suffix_generator，使用cmd或者Termial终端运行，且需要加入USB的VID和PID信息进行交叉校验\n 路径为：XVF3510-UA-Unqualified-Release_4.1.0rc1/host/Win32/bin/dfu_suffix_generator.exe\n 其简化（路径）的运行指令如下，其中 0x20B1 0x0014分别为USB VID和PID。\n1  dfu_suffix_generator 0x20B1 0x0014 data_partition_upgrade_user_define_xvf3510_v4_1_0.bin data_user_define_dfu_update.dfu   最后一步，把上一步生成data_user_define_dfu_update.dfu结合boot.dfu进行DFU升级，使用的工具为dfu_usb\n 路径为：XVF3510-UA-Unqualified-Release_4.1.0rc1/host/Win32/bin/dfu_usb.exe\n 其简化（路径）的运行指令如下，其中 0x20B1 0x0014分别为USB VID和PID。\n1  dfu_usb --vendor-id 0x20B1 --product-id 0x0014 write_upgrade boot.dfu data_xvf3510_usb_aec_ref_16K_v4_1_0.dfu   其他操作系统也是同样的指令，可以结合上文提供的Windows提供的批处理文件，制作类似的shell脚本。\n资源 P3510-2MIC.zip全部的资料(点击下载)\n支持和商务 P3510-2MIC支持PCBA定制服务，提供批量PCBA和芯片供应服务。\n任何的技术支持和商务合作，可以直接邮箱联系我们：p3510-2mic@pawpaw.hk，或者访问www.pawpaw.hk了解更多。\nFAQ Q1: boot.dfu和data_xxx.dfu的区别？\nboot.dfu是XVF3510的基础固件，内含DSP算法和控制等基础程序，data_xxx.dfu为配置固件，修改boot.dfu里面的参数。所以在DFU的时候，两个固件都需要添加进去\nQ2: DFU更新完之后，在windows操作系统下使用audacity录制出错的原因\n出现该问题仅是在Windows系统，其他操作系统Mac和Linux并不会存在这个情况。由于windows系统对声卡有记忆功能，DFU固件了后，可能改变了与之前声卡的记忆，导致了使用第三方软件如audacity无法录制音频，这时需要使用usbdeview进行删除Windows的对声卡的记忆。\nUSB连上P3510-2MIC和windows PC，运行usbdeview，点击Connected栏项以列出XVF3510相关枚举情况；逐一选择XVF3510的枚举，右击后出现新的界面；选择Uninstall Selected Devices进行删除Windows的声卡的记忆；重新上电即可。\nQ3：dfu_usb和vfctrl_usb显示could not find device和无法使用的原因？\n确保USB连接了P3510-2MIC和PC，并且确保已经使用了zadig进行安装了XMOS Control的驱动。如果问题仍出现，尝试确认一下XMOS Control是否已经枚举，亦或者卸载XMOS Control驱动，并且使用zadig重新按照。\nQ3: 有提供例程连接语音识别平台吗？\n抱歉，这方面我们没有提供例程，类似Alexa和Aliyun等语音识别API，我们没有办法提供相关例程。\nQ4：把P3510-2MIC装上产品的结构外壳上，有哪些声学方面需要注意的吗？\n我们建议使用裸板进行使用，这样的性能效果是最佳的，如果确实需要组装到产品结构上，我们建议在麦克风上（顶部拾音）加个密封胶套，以确保声音不进入到结构里面进行不断的反射形成混响。同时我们考虑在下个硬件版本配套提供密封胶套\n","description":"","id":9,"section":"docs","tags":null,"title":"P3510-2MIC_硬件使用","uri":"http://docs.pawpaw.ltd/docs/p3510-2mic/p3510-2mic_usage/"},{"content":"概要 PXVF3500-KIT是针对XMOS的XK-VF3500-L33 开发板的硬件升级，优化了硬件设计及布局，更加适合用户直接使用和项目评估。完全兼容XMOS的XK-VF3500-L33 开发板，所用的DSP芯片为XVF3500。XMOS最新更新发布的XVF3500的固件完全适用于PXVF3500-KIT。\nPXVF3500-KIT为4麦线条型阵列设备，作为前端信号处理，实现语音增强，可同时输出两路前端处理后的声音信号，且其分别为用于语音识别（ASR，Automatic Speech Recognition ）和用于会议电话（Comms, communication and conferencing）。支持使用USB Audio Class 1协议（UAC1.0）传输音频 ，支持所有流行的操作系统（Windows , MAC, Linux和Android），允许作为USB声卡设备枚举接入操作系统中。\nPXVF3500-KIT内置了立体声回音消除（AEC） , 波束程序（BF），噪声抑制（NS）和自动增益（AGC）算法，非常有效地实现在远距离和嘈杂环境提高语音识别率和通话质量。使用USB 接口快速接入各种操作系统，同时配套提供了多套固件，非常适用用户迅速接入语音产品中。\n版本    产品版本 修改 发布时间     PXVF3500-KIT v1 初次发布 2018年8月6日    特点   前向180度远距离拾音\n  支持USB Audio Class 1.0 (UAC 1.0)\n  支持USB Control 调试\n  线条型（Linear）4路麦克风阵列\n  支持3.5mm耳机孔作为模拟AEC参考信号\n  支持3.5mm耳机孔作为USB声卡播放\n  DSP 算法和特点\n· Voice Activity Detection(VAD)\n· Full duplex, stereo, Acoustic Echo Cancellation(AEC)\n· Beamforming(BF)\n· Noise Suppression (NS)\n· Automatic Gain Control (AGC)\n  规格   XMOS XVF3500 主控，内置4麦阵列算法\n  4路PDM 数字麦克风： SPH0641LM4H-1\n· Sensitivity: -26 dBFS (Omnidirectional)\n· Acoustic overload point: 120 dBSPL\n· SNR: 64 dBA\n  供电：USB 5V\n  尺寸：\n· 86mmx45mm (main board)\n· 110mmx8.2mm (mic board) \u0026amp; 33.3mm 麦克风间距\n  可选模拟AEC参考信号输入\n  · ADC: ES7243\n· 3.5mm耳机孔\n  音频传输：\n· USB UAC 1.0 输入，ASR and Comms\n· USB UAC 1.0 输出，可选在UAC playback作为AEC 参选信号，3.5mm耳机孔模拟输出\n· 采样率：16KHz/48KHz（默认）\n  功耗: 5V, 260mA （Max）\n  硬件概述  XMOS XVF3500 ：集成了UAC1.0和4 麦阵列算法，包含了立体声回音消除（Steroe AEC） , 波束成形（BF），噪声抑制（NS）和自动增益（AGC）算法 Micro USB : 提供5V电源，并且传输音频和固件更新，控制和调试 QSPI Flash：存储XVF3500固件 DAC ES7154：USB 声卡（UAC1）音频输出解码芯片 ADC ES7243：选择模拟信号作为AEC参考信号时，转I2S数字信号给XVF3500(可选项) XMOS XTAG：XMOS专用调试工具XA-XTAG接口 Line-out Phone-jack：DAC的芯片的line-out 3.5mm耳机孔 LIne-in Phone-jack：ADC芯片的Line-in 3.5mm耳机孔 MIC0~4：PDM 数字麦克风，线条型等距（33.3mm）分布 FPC interface: 通过FPC线把XVF3500的4路麦克风扩展出一个独立麦板 Buffer logic IC: PDM 麦克风data和CLK pin驱动能力加强和MUTE控制  系统连接框图 尺寸 应用场合  视频通话（Comms） 机顶盒（ASR） Soundbar（ASR） 智能电视（ASR）  开始 第一个Demo 通常情况下，用户拿到PXVF3500-KIT PCBA板后，建议先在Windows系统做初步使用和认证。使用Micro USB 数据线来连接PXVF3500-KIT和Windows系统电脑，需要做初步设置和确认。\n声卡设备设置 确认Windows设备管理器已经成功枚举了PXVF3500-KIT，并且打开声音控制面板进行设置\n确认设备管理器-\u0026gt;音频输入和输出是否存在\nXMOS VoclalFusion St(uac1.0)是否成功枚举，PXVF3500-KIT作为USB Audio Class 1.0设备\n关于XMOS Control可以在后面需要调试时在安装驱动，初次使用时可以先跳过 在声音界面进行设置和确认\n1，在播放栏项，设置XMOS VoclalFusion St(UAC1.0)为默认设备\n2，在录制栏项，设置XMOS VoclalFusion St(UAC1.0)为默认设备\n3，同时确认播放和录制栏项的音频格式设置为一致，如16bit ，16000KHz或者16bit 48000KHz\nDemo 和录音 使用Audacity第三方开源录音软件在Windows系统进行录音设置，运行Audacity进行录音。\nPXVF3500-KIT出厂默认固件为USB输入8ch 16kHz采样率处理后的声源，其中ch0为Comms信号，ch1为ASR信号ch[2-5]为mic[0-3] 麦克风的原始信号，ch[6-7]为回音消除的立体声参考信号。\n在通常的操作系统中，系统都会默认使用ch0作为ASR或者Comms来当作麦克风输入，所以PXVF3500-KIT输入8ch并不会影响实际上的使用。 在其他操作系统如MAC OSX和Linux操作系统，Demo和录音的用法跟Windows类似。\n固件和DFU升级 如果PXVF3500-KIT的出厂默认固件满足不了用户的配置需求，可以在Firmware中选择其他配套的固件，使用USB数据线连接PC电脑，使用配套提供的DFU(Device Firmware Update)工具进行更新固件。\n安装驱动 Windows系统：\nPXVF3500-KIT在操作系统中都能识别成XMOS VoclalFusion St(uac1.0)作为声卡输入输出，而Windows系统中的设备管理器显示的XMOS Control需要安装USB驱动，才能使用XMOS提供的dfu_usb工具进行升级和使用vfcrtol_usb工具进行DSP 参数控制。推荐使用第三方工具zadig进行安装XMOS Control的USB驱动。\n运行zadig，\n 在列表中选择 XMOS Control (Interface 3) 然后选择 libusb-win32 点击 Reinstall Driver 安装完成了后，则会出现类似如下图片显示  Linux系统：不需要安装驱动\nMac 系统：不需要安装驱动\n固件列表 这里配套提供了7个固件，主要是USB的音频的通道数，算法方向和采样率作为区别，参考下表。\n   Firmware ch0 ch1 采样率 Description     app_vf_stereo_base_usb_1i1o2.dfu Comms - 16000Hz Comms output   app_vf_stereo_base_usb_1i1o2_asr.dfu ASR - 16000Hz ASR output   app_vf_stereo_base_usb_1i1o2_48k.dfu ASR - 48000Hz 48kHz Comms output   app_vf_stereo_base_usb_1i2o2.dfu Comms ASR 16000Hz ch0:ASR; ch1:Comms   app_vf_stereo_base_usb_1i2o2_48k.dfu Comms ASR 48000Hz ch0:ASR; ch1:Comms   app_vf_stereo_base_usb_1i8o2.dfu Comms ASR 16000Hz default firmware ch0:Comms; ch1:ASR; ch2:mic0; ch3:mic1; ch4:mic2; ch5: mic3 ch6: aec_ref_l;ch7: ace_ref_r   app_vf_stereo_base_usb_1i8o2_analog_ref.dfu ASR ASR 16000Hz ch0:Comms; ch1:ASR; ch2:mic0; ch3:mic1; ch4:mic2; ch5: mic3 ch6: aec_ref_l;ch7: ace_ref_r    DFU升级 Windows系统：\nPXVF3500-KIT的使用USB进行DFU升级的工具为dfu_usb.exe，打开cmd命令行终端工具，cd进入pvf3500/xvf3500_dfu文件夹，键入如下指令或者或者复制其中对于固件的指令进行运行。\ndfu_usb write_upgrade ../firmware/app_vf_stereo_base_usb_1i1o2.dfu\r执行完之后，打印出一下信息说明固件DFU升级成功\n Attempting to connect via USB: connected\rSending file size: 0x38800 padded to 0x38800\rWritten bytes: 0x38800\rdone\r其他操作系统如Mac OS和Linux的使用Terminal，键入指令和打印的内容一致。DFU升级成功后，需要对板子重启或者重新上电\ndfu_usb reboot\r在通常情况下，在windows系统DFU升级成功后，PXVF3500-KIT会遇到无法录制使用，问题可以在[FAQ](# FAQ):Q1找到答案 DSP control 在线调试 上文提供的所有固件都是使用XMOS Vocal Fusion默认的DSP参数，其实PXVF3500-KIT也支持在线调试麦克风阵列DSP 算法参数。使用DSP Control工具为vfctrol_usb（exe）。在进行在线调试工作前，建议用户认真阅读XMOS的文档资料[XVF3500 DSP Databrief.pdf](pxvf3500/doc/XVF3500 DSP Databrief.pdf)。足够了解麦克风阵列相关算法名称和DSP 参数，才方便进行在线调试。并且下文描述内容跟XMOS提供的文档一致。\n以下内容已经假设用户对麦克风阵列的DSP算法，已经有一定的了解，或者根据文档自行了解熟悉，并且了解其DSP参数和数值\nAcoustic Echo Cancellation (AEC)\nBeamforming(BF)\nVoice Activity Detection (VAD)\nNoise Suppression (NS)\nAutomatic Gain Control (AGC)\n 在线调试 windows系统\n确保PXVF3500-KIT在设备管理器中的XMOS Control驱动已经安装（仅windows系统需要）\nwindows系统，运行cmd，并且cd进入pxvf3500/xvf3500_control，键入类似指令以运行vfctrol_usb，便可进行在线调试\nvfctrl_usb MIN_NS\r打印输出的信息如下：\nMIN_NS:0.15\r其他操作操作系统运行Terminal终端，但是同时需要提前编译出vfctrol_usb工具，进行同样的操作即可。cd进入路径pxvf3500/xvf3500_control/host/control。\nMac OS:\nmake -f Makefile.OSX\rLInux:\nmake -f Makefile.Linux64\rRaspberry Pi\nmake -f Makefile.Pi\rXVF3500里面有很多DSP参数可配置，用户根据[XVF3500_DSP_Databrief.pdf](pxvf3500/doc/XVF3500 DSP Databrief.pdf )\n的介绍，可以实现通过USB HID（XMOS Control）进行在线调试参数\n在线调试的参数仅存在XVF3500 RAM内存中， 断电即复位为默认值，如确实需要保存已调试的参数到flash中，需要生成DFU配置固件。 资源下载 PXVF3500-KIT.zip全部的资料(点击下载)\n支持和商务 PXVF3500-KIT支持PCBA定制服务，提供批量PCBA和芯片供应服务。\n任何的技术支持和商务合作，可以直接邮箱联系我们：pxvf3500@pawpaw.hk，或者访问www.pawpaw.hk了解更多。\nFAQ Q1: DFU更新完之后，在windows操作系统下使用audacity录制出错的原因\n出现该问题仅是在Windows系统，其他操作系统Mac和Linux并不会存在这个情况。由于windows系统对声卡有记忆功能，DFU固件了后，可能改变了与之前声卡的记忆，导致了使用第三方软件如audacity无法录制音频，这时需要使用usbdeview进行删除Windows的对声卡的记忆。\nUSB连上PXVF3500-KIT和windows PC，运行usbdeview，点击Connected栏项以列出XVF3500相关枚举情况；逐一选择XVF3500的枚举，右击后出现新的界面；选择Uninstall Selected Devices进行删除Windows的声卡的记忆；重新上电即可。\nQ2：dfu_usb和vfctrl_usb显示could not find device和无法使用的原因？\n确保USB连接了PXVF3500-KIT和PC，并且确保已经使用了zadig进行安装了XMOS Control的驱动。如果问题仍出现，尝试确认一下XMOS Control是否已经枚举，亦或者卸载XMOS Control驱动，并且使用zadig重新按照。\nQ3: 有提供例程连接语音识别平台吗？\n抱歉，这方面我们没有提供例程，类似Alexa和Aliyun等语音识别API，我们没有办法提供相关例程。\n","description":"PXVF3500-KIT_硬件使用","id":10,"section":"docs","tags":null,"title":"PXVF3500-KIT_硬件使用","uri":"http://docs.pawpaw.ltd/docs/pxvf3500-kit/pxvf3500-kit_usage/"},{"content":"本子系统(docs.pawpaw.ltd)是木瓜电子(www.pawpaw.hk)的文档系统网址的补充，为协助用户对木瓜电子开发的开发板评估板的快速使用而生\n关于我们 深圳市木瓜电子科技有限公司（“木瓜电子”）是一家专注于提供音频技术和音频芯片供应服务的芯片代理商和音频方案商。\n木瓜电子(www.pawpaw.hk)是XMOS的代理商和技术提供商，于2015年，经过多方资源整合打造国内最专业的XMOS技术支持团队，拥有国内最专业的XMOS技术人才，英国XMOS原厂授权麦克风阵列产品线国内唯一的合作伙伴。\n关于XMOS XMOS(www.xmos.ai)是音频领域芯片供应的领导者，专注提供音频接口(USB AUDIO)和音频DSP算法，目前已经成熟向市场提供了XVF3000和XVF3500 4路麦克风阵列，以及XVF3510 2路麦克风阵列完整解决方案，应用语音识别和会议通话等产品中。\n在XMOS网址找到木瓜电子 XMOS网站链接如下可以找到木瓜电子网站入库：https://www.xmos.ai/design-support\n","description":"深圳市木瓜电子科技有限公司的文档系统 docs.pawpaw.ltd的使用说明和主网站的区分","id":11,"section":"about","tags":null,"title":"公司介绍","uri":"http://docs.pawpaw.ltd/about/%E5%85%AC%E5%8F%B8%E4%BB%8B%E7%BB%8D/"},{"content":"Coming soon\n","description":"","id":12,"section":"about","tags":null,"title":"商务合作","uri":"http://docs.pawpaw.ltd/about/%E5%95%86%E5%8A%A1%E5%90%88%E4%BD%9C/"},{"content":"PXVF3000-KIT\n.PXVF3000-KIT_硬件使用资料包.zip\nP3510-2MIC\n.P3510-2MIC_硬件使用资料包.zip\nPXVF3500-KIT\nComing soon\n","description":"PXVF3000-KIT, P3510-2MIC, P3500-KIT ,PXUA216MB-DL2-M等工具（windows系统）下载","id":13,"section":"download","tags":null,"title":"工具和应用下载","uri":"http://docs.pawpaw.ltd/download/%E5%B7%A5%E5%85%B7%E5%92%8C%E5%BA%94%E7%94%A8%E4%B8%8B%E8%BD%BD/"},{"content":"Coming soon\n","description":"","id":14,"section":"about","tags":null,"title":"技术支持","uri":"http://docs.pawpaw.ltd/about/%E6%8A%80%E6%9C%AF%E6%94%AF%E6%8C%81/"},{"content":"阅读前确认 用户需要确认一下内容，以方便阅读下文\n 已拥有了pxvf3500-KIT，且查阅pxvf3500-KIT_硬件使用 已详细了解XVF3500 内置的前端算法AEC , BF , NS, AGC,，且已查阅pxvf3500-KIT_dsp_描述 已查阅本站XVF3500项目实施落地 已查阅了XVF3500的datasheet和参考设计 已确认XMOS XVF3500 4路麦克风阵列方案性能可满足导入项目产品中  XVF3500 datasheet 导读 查看XVF3500-FB167-Datasheet_1.2.pdf，其描述的为XVF3500裸片（不含固件）的硬件特性。了解基本的硬件数据，电气特性。\n基本特性  商用温度等级（0 °C to 70 °C） FBGA 167 封装 685mA典型工作电流，1W左右（固件运行） I/O 驱动能力为4mA 订购型号：XVF3500-FB167-C； 丝印：VSM05C  电源 根据datasheet的最小系统框图，XVF3500的需要两路电压供应，3V3和1V0, 其中3V3提供给I/O, USB , Flash等外设使用，1V0提供给XVF3500逻辑核心使用。\n其两路电压时序要求为3V3先上电，稳定后，1V0后上电。\n复位检测 XVF3500需要外部有复位检测芯片，可以选择单独侦测 3V3或者1V0，以避免在电压不正常时，芯片无法复位来运行固件。\nQSPI Flash XVF3500需要外置QSPI Flash（类似GD25Q16或者IS25LP016D），其主要是存储XVF3500固件，所以XVF3500项目得预先烧录固件才能启动运行4路麦克风阵列算法。\n使用QSPI Flash烧录器烧录XVF3500需要配置QE=1的烧录方式。\nBOOT MODE XVF3500的需要读取QSPI Flash芯片程序来启动，根据框图连接XVF3500和Flash时，需要确保QSPI_CS引脚上拉1K电阻，以实现boot mode是由XVF3500芯片读取加载内部的QSPI Flash固件。\nI/O 映射 XVF3500的逻辑I/O接口的功能使用由固件定义，datasheet 无描述I/O 功能使用，需参考木瓜电子或者XMOS官方提供的的原理来选择使用特定的I/O map。\n时钟信号 XVF3500外部需要24MHz有源晶振接入作为启动晶振，接入到CLK 引脚，而音频时钟16KHz 和48KHz采样率仍需要一个外部的12.2888MHz音频时钟或者晶体接入作为I2S或者PDM麦克风的MCLK时钟使用。\n原理图和PCB 根据我司或者XMOS官方的提供的参考原理，结合XVF3500的datasheet最小系统。用户可以比较轻易完成XVF3500的最小系统设计，包含了电源，时钟，启动上拉等。\n原理图设计 USB 接口设计 在XVF3500 条形4路麦克风阵列方案中，USB接口除了提供5V电源供应，USB接口仍需要用来作为音频传输，DFU固件，vfctrl调试参数。\nXVF3500 芯片内部集成了USB PHY收发器，可以直接使用芯片引脚USB_DM,USB_DP,USB_VBUS,USB_RTUNE连接外部USB端子。\n遵循XVF3500 datasheet说明，USB的设计分为USB供电或者外部电源作为XVF3500芯片供电两种情况，如图为USB作为整个XVF3500系统供电原理设计\n根据XVF3500 datasheet的描述\n USB_RTUNE 需要下拉43.2 R电阻 USB_VBUS 不能连接，需悬空 USB_VBUS提供5V给DC-DC 转换3V3和1V0电源提供给XVF3500和外围芯片 因为XVF3500 的ESD压力为2KV,建议用户在USB端子设计加入ESD保护电路芯片  如内部有电池或者外部供应5V给整个电源系统，则USB_VBUS的设计需要参考XVF3500 datasheet（page 19）的USB_VBUS设计。\n The 10k series resistor and 0.1uF capacitor ensure than any input transient is filtered and does not reach the device. The 47k resistor to ground is a bleeder resistor to discharge the input capacitor when VBus is not present. The 1-10uF input capacitor is required as part of the USB specification. A typical value would be 2.2uF to ensure the 1uF minimum requirement is met even under voltage bias conditions\n 如用户决定使用XVF3500使用I2S输入输出来连接host主控（ARM,BT,WiFi等芯片）代替USB作为音频传输，同时强烈建议前期保留USB端子以便进行dfu_usb和vfctrl_usb使用。后期确定量产时再去掉USB部分。\n电源设计 XVF3500 内部无DC-DC和LDO集成，需要外部提供3V3和1V0的供电。其中3V3提供给XVF3500及其集成的部分的 I/O供电，1V0供应XVF3500核心及其集成组件的核心使用。查看datasheet的5 Example Application Diagram的框图，得到XVF3500电源的需求情况。\n3V3 供应部分\n3V3电压范围（3.135 ~ 3.465 V）\n VDDIO (3V3) : Digital I/O power OTP_VCC (3V3) :pins for OTP USB_VDD33 (3V3) : USB Analog power,analog supply to the USB-PHY  1V0 供应部分\n1V0电压范围（0.95 ~ 1.05 V）\n VDD pins (1V0)：Digital tile power ，for the core logic PLL_AVDD (1V0) : Analog power for PLL, pins for the PLL USB_VDD (1V0) : USB Digital tile power , supply to the USB-CORE  查看datasheet的Power Consumption 部分得到XVF3500的核心供电需求电流为600 mA左右（700mA MAX）, 确保DC-DC电源芯片1V0输出需要大于700mA，建议值1A的输出能力,且不能使用LDO电源芯片输出1v0,导致损耗过大。\n根据datasheet所述的3V3和1V0的上电时序要求，我们建议整体电源设计的时序为3V3先上电，然后使能（enable）1v0后上电\n其电源设计如下图，其中\n 3V3由5V DC-DC转换得到，3V3先稳定后，使能另一个DC-DC转换得到1V0 ; 形成 3V3先上电，1V0后上电的时序 3V3和1V0分别供应相应的电源输入引脚，尽量保证每个电源输入引脚有个104的滤波电容，且这些电容在layout的时候，尽量靠近相应的电源引脚。 pin 50 和 pin 65 必须悬空，不能接任何电气 PLL_AVDD 需要一个高品质的电源，在PLL_AVDD引脚加入RC 低通滤波器，且在layout的时候，4R7电阻和104电容需要尽可能靠近PLL_AVDD引脚  系统设置 XVF3500外围需要两个有源晶振，24 MHz 和 12.288 MHz：\n 24 MHz时钟为XVF3500起振时钟，提供给内部PLL产生芯片主频，24 MHz有源晶振输出接入XVF3500的CLK 引脚。 12.288 MHz时钟为XVF3500核心（Tile 1 和Tile 2）处理音频传输协议需要的音频时钟，XVF3500核心将12.288 MHz进行分频，分别生成I2S 的 LRCLK , BCLK 和 PDM 协议的CLK。 所以12.288 MHz需要分出多路时钟出来，作为MCLK分别输入到XVF3500 Tile 1 ,Tile 2 和ADC/DAC使用。  XTAG接口为XMOS专用的调试和烧录工具，XVF3500需要下使用XTAG烧录factoy固件到外置的QSPI Flash芯片了后，XVF3500才能正常运行麦克风阵列算法，在原理设计时，需要引出XTAG接口，以便样机时调试和烧录XVF3500固件。\nXVF3500外部需要有个复位检测芯片，避免供电电压不正常时导致固件运行紊乱，根据datasheet的描述，其复位时间必须为1ms~10ms之间的拉低时间\n If your design is powered by VBUS,then RST_N should go high within 10 ms of attaching to VBUS in order to ensure that USB timings are met. RST_N should be at least 1 ms after VDDIO good to enable the built-in flash to settle.\n 由于XVF3500的级联特殊要求（XMOS的芯片的Tile2与Til1 级联，共同访问外部QSPI Flash芯片），XVF3500的X2D06必须上拉电阻，\n其整体设计为, 其中：\n XTAG 建议接一个2x5 1.27mm的母座端子引出，方便烧录和调试,且脚位排序不变 QSPI_CS_N需要上拉1K电阻, 确保XVF3500上电时能够访问外部的QSPI Flash 12.288 MHz有源晶振时钟分出3路时钟，分别提供Tile 0，Tile 1和Codec作为MCLK使用，如果PCBA板子布线较长，建议加个buffer logic器件加以增大驱动能力  音频I/O XVF3500 支持多路PDM麦克风，但是XMOS官方vocal Fusion算法仅支持4路麦克风阵列算法。多路PDM麦克风接口复用1个clk 时钟信号线，以确保多路麦克风信号高一致性。多路麦克风data信号线各自独立，不分L/R时序。\nXVF3500 支持2路I2S 接口，其I2S协议为标准I2S, 64fs, 有效位可以实现16bit/24bit。 如果I2S连接ADC或者DAC, 则XVF3500 的I2S为master模式 ; 如果XVF3500 连接蓝牙/wifi/CPU, 则XVF3500都可以选择master/slave模式。两路I2S都复用MCLK , LRCLK , BCLK。\n其中XVF3500的音频接口PDM和I2S的时钟频率为：\nPDM_CLK: 3.072 MHz\nI2S_MCLK: 12.288 MHz\nI2S_BCLK: 1.024 MHz(@16KHz sample rate) I2s_LRCLK: 16 KHz(@16KHz sample rate)\nXVF3500的DAC和ADC选型设计，根据用户项目框架的需要，参考本站XVF3500项目实施落地的应用框架而确定是否都需要ADC和DAC的设计。可以简单理解为：\n 需要XVF3500作为UAC设备播放声音，则需要加上DAC 需要接模拟信号作为XVF3500作为AEC参考信号，则需要加上ADC  选择相应的DAC和ADC需要吻合XVF3500的I2S时序，且尽量免I2C配置，为I2S自适应的Codec，避免XVF3500固件有过多的I2C配置造成软件工程师过多投入。\n其整体设计如下图，其中:\n  X2D06(pin N13)为上章提到的XVF3500所需的上拉，在下图体现出来。\n  每个所用到的I/O都是XVF3500软件定义，由于需要配合现成的固件，所以I/O不建议更换\n  4个PDM 麦克风的LR 引脚都需要统一拉低接地。如成本允许，单独生成3V3A干净电源提供给麦克风供电。\n  pxvf3500-KIT评估板麦克风布局为33.3mm的条线均匀分布，如需其他条形尺寸，麦克风的间距不小于30 mm,其最大间距由TTL受干扰限制，不建议太大，XVF3500 I/O驱动能力仅为4mA。如更改了麦克风的间距尺寸，需要通知固件方修改软件以匹配阵型\n  用户根据项目框架需要是否DAC\n  用户根据项目框架需要是否ADC，并且建议模拟参考信号（analog AEC ref）在播放的运放前端接入，同时建议设计分压电路，查看ADC的满框输入水平（Full Scale Input Level ）,以确定模拟信号进行分压时，匹配相应的电阻值\n  用户尽量选择免I2C配置的ADC和DAC，选择I2S自适应的Codec，则不需要通知固件方进行I2C配置来吻合XVF3500的I2S协议和驱动Codec\n  控制I/O XVF3500固件内部仍有小些逻辑控制资源，可以实现控制LED，按键等功能。LED的控制主要VAD(人声检测)指示使用。\n按键控制建议仅用在麦克风的静音（MUTE信号）。如功能上需要用到麦克风静音功能，建议在4路PDM复用的CLK引脚加上逻辑器件，实现电气上的静音。\n其整体设计如下图，其中：\n  补充MCLK_Tile 1 接入到X1D10, XVF3500 Til0 运行16 KHz的麦克风阵列算法，需要外部提供音频时钟信号。\n  LED为VAD（人声检测）指示使用，如不需要LED指示，可全部去掉\n  MIC_CLK拉高拉低都可以实现麦克风信号静音（MUTE）,这里建议用户增加逻辑logic器件来实现物理上MUTE。不建议在XVF3500固件来时间音量+，音量—，会涉及投入比较大的固件开发。如需要，建议直接控制运放。\n  检查表 Check List 框架检查  USB 需要做保留设计，无论是是否有使用I2S作为音频传输，USB的dfu_usb和vfctrl_usb仍需要使用 XVF3500的XTAG设计建议使用2x5母座端子，间距1.27mm；或者2x10的2.54mm的母端子，避免留出测试点接线麻烦的方式。木瓜电子可提供转接板，同时用户需要购买XTAG烧录器 XVF3500需要置了QSPI Flash，样机或者量产前，需提前烧录XVF3500的固件到QSPI Flash芯片上，同时确保使用QSPI flash烧录方式QE=1的配置烧录。要求用户需要拥有flash烧录器，类似硕飞的SP8-B等设备。 确认好AEC ref的提供给XVF3500的方式，以便确认是否ADC和DAC  原理图和PCB检查  查阅XVF35000的datasheet的Check list(page 74) 查阅XVF35000的VocalFusion Speaker Hardware Manual.pdf 复位芯片是必须要的，可以选择侦测3V3和1V0 麦克风layout布局，建议每个麦克风间距不小于30mm Layout时，USB型号尽量并行走线且不靠近I2S/PDM的时钟线 Layout时，需要考虑量产时，麦克风需要加上密封胶套来配合结构外壳，达到声学要求  PCBA问题排查 USB不能正常枚举出声卡设备\n 确认硬件的电源3V3和1V0是否正常; 确认24 MHz时钟正常进入XVF3500; 确认复位检查芯片是否拉住了XVF3500的复位 确认XVF3500是否已有固件；确认使用QSPI Flash烧录器烧录固件时，配置QE=1，并且烧录时已把配置烧录进去。XVF3500已烧录固件时，板载5V电源会在大于150mA  判断麦克风是否良好\n 烧录或者dfu_usb一个8通道固件，把4个麦克风原始信号在audactiy录制查看，或者使用AP分析  AEC 性能不好\n 如是模拟参考信号到ADC提供给XVF3500的方式，确认ADC接收到的模拟参考信号是否正常，是否有作为分压输入水平不超过ADC的满框输入水平 如是USB提供参考信号给XVF3500的方式，确保DAC或者功放不能有EQ处理再喇叭播放。 确认整个过程中喇叭和麦克风的相对位置没有任何变动 确认喇叭到麦克风声压不大于100dB 确认麦克风有足够好的密封性  服务 XVF3500的硬件设计用户需要自行完成，结合木瓜电子提供的参考原理图设计（pxvf3500-KIT 评估板），XVF3500 datasheet和VocalFusion Speaker Hardware Manual文档完成设计。\n木瓜电子可以为用户提供XVF3500 固件，整体设计如有技术问题，可以发邮件发pxvf3500@pawpaw.hk咨询。\n木瓜电子可以提供XMOS XVF3500 , 麦克风和Code芯片供应服务。\n","description":"介绍XMOS  vocal Fusion麦克风阵列的XVF3500硬件设计，涉及到sch和PCB方面的内容，包含XVF3500最小系统，AEC的ADC，DAC设计，4路麦克风阵列摆放，以及麦克风阵列量产指导","id":15,"section":"docs","tags":null,"title":"XVF3500硬件设计","uri":"http://docs.pawpaw.ltd/docs/pxvf3500-kit/xvf3500_hw_deseign/"}]